# GitHub Copilot æ¸¬è©¦ç”¢ç”ŸæŒ‡å¼•

## ğŸ“‘ ç›®éŒ„

- [ğŸ¯ æ¸¬è©¦ç›®æ¨™](#-æ¸¬è©¦ç›®æ¨™)
- [ğŸ“‹ æ¸¬è©¦æ¡†æ¶](#-æ¸¬è©¦æ¡†æ¶)
  - [ä½¿ç”¨çš„å·¥å…·](#ä½¿ç”¨çš„å·¥å…·)
- [ğŸ—ï¸ æ¸¬è©¦çµæ§‹](#-æ¸¬è©¦çµæ§‹)
  - [åŸºæœ¬æ¨¡æ¿](#åŸºæœ¬æ¨¡æ¿)
- [ğŸ“ æ¸¬è©¦å‘½åè¦ç¯„](#-æ¸¬è©¦å‘½åè¦ç¯„)
  - [describe å€å¡Š](#describe-å€å¡Š)
  - [it æ¸¬è©¦æ¡ˆä¾‹](#it-æ¸¬è©¦æ¡ˆä¾‹)
- [ğŸ§ª æ¸¬è©¦é¡å‹](#-æ¸¬è©¦é¡å‹)
  - [1. å…ƒä»¶æ¸¬è©¦](#1-å…ƒä»¶æ¸¬è©¦)
    - [åŸºæœ¬å…ƒä»¶æ¸¬è©¦](#åŸºæœ¬å…ƒä»¶æ¸¬è©¦)
    - [æ¸¬è©¦ Signals](#æ¸¬è©¦-signals)
  - [2. æœå‹™æ¸¬è©¦](#2-æœå‹™æ¸¬è©¦)
    - [åŸºæœ¬æœå‹™æ¸¬è©¦](#åŸºæœ¬æœå‹™æ¸¬è©¦)
    - [æ¸¬è©¦ Signals æœå‹™](#æ¸¬è©¦-signals-æœå‹™)
  - [3. æ•´åˆæ¸¬è©¦](#3-æ•´åˆæ¸¬è©¦)
- [ğŸ¯ æ¸¬è©¦æ¶µè“‹ç¯„åœ](#-æ¸¬è©¦æ¶µè“‹ç¯„åœ)
  - [å¿…é ˆæ¸¬è©¦çš„é …ç›®](#å¿…é ˆæ¸¬è©¦çš„é …ç›®)
  - [æ¸¬è©¦ç¯„ä¾‹](#æ¸¬è©¦ç¯„ä¾‹)
- [ğŸ› ï¸ æ¸¬è©¦å·¥å…·å’ŒæŠ€å·§](#-æ¸¬è©¦å·¥å…·å’ŒæŠ€å·§)
  - [Mock æœå‹™](#mock-æœå‹™)
  - [Spy ä½¿ç”¨](#spy-ä½¿ç”¨)
  - [ç•°æ­¥æ¸¬è©¦](#ç•°æ­¥æ¸¬è©¦)
- [âœ… æ¸¬è©¦æœ€ä½³å¯¦è¸](#-æ¸¬è©¦æœ€ä½³å¯¦è¸)
  - [1. AAA æ¨¡å¼](#1-aaa-æ¨¡å¼)
  - [2. æ¸¬è©¦éš”é›¢](#2-æ¸¬è©¦éš”é›¢)
  - [3. æ¸…æ™°çš„æ–·è¨€](#3-æ¸…æ™°çš„æ–·è¨€)
  - [4. é¿å…æ¸¬è©¦å¯¦ä½œç´°ç¯€](#4-é¿å…æ¸¬è©¦å¯¦ä½œç´°ç¯€)
- [ğŸ“Š æ¸¬è©¦è¦†è“‹ç‡](#-æ¸¬è©¦è¦†è“‹ç‡)
  - [ç›®æ¨™](#ç›®æ¨™)
  - [æª¢æŸ¥è¦†è“‹ç‡](#æª¢æŸ¥è¦†è“‹ç‡)
  - [è¦†è“‹ç‡å ±å‘Š](#è¦†è“‹ç‡å ±å‘Š)
- [ğŸš« é¿å…çš„åæ¨¡å¼](#-é¿å…çš„åæ¨¡å¼)
  - [1. éåº¦ Mock](#1-éåº¦-mock)
  - [2. æ¸¬è©¦éæ–¼è¤‡é›œ](#2-æ¸¬è©¦éæ–¼è¤‡é›œ)
  - [3. ç¡¬ç·¨ç¢¼æ¸¬è©¦è³‡æ–™](#3-ç¡¬ç·¨ç¢¼æ¸¬è©¦è³‡æ–™)
- [ğŸ“š åƒè€ƒè³‡æº](#-åƒè€ƒè³‡æº)

---


> æœ¬æª”æ¡ˆå®šç¾© GitHub Copilot ç”¢ç”Ÿæ¸¬è©¦æ™‚çš„æ¨™æº–å’Œæœ€ä½³å¯¦è¸ã€‚

## ğŸ¯ æ¸¬è©¦ç›®æ¨™

æ¸¬è©¦æ‡‰è©²ï¼š
1. é©—è­‰åŠŸèƒ½æ­£ç¢ºæ€§
2. æ¶µè“‹é‚Šç•Œæƒ…æ³å’ŒéŒ¯èª¤è™•ç†
3. ä¿æŒå¯ç¶­è­·æ€§å’Œå¯è®€æ€§
4. éµå¾ªå°ˆæ¡ˆæ¸¬è©¦è¦ç¯„

## ğŸ“‹ æ¸¬è©¦æ¡†æ¶

### ä½¿ç”¨çš„å·¥å…·
- **æ¸¬è©¦æ¡†æ¶**ï¼šJasmine
- **æ¸¬è©¦åŸ·è¡Œå™¨**ï¼šKarma
- **Angular æ¸¬è©¦å·¥å…·**ï¼š@angular/core/testing
- **è¦†è“‹ç‡è¦æ±‚**ï¼šâ‰¥ 80%

## ğŸ—ï¸ æ¸¬è©¦çµæ§‹

### åŸºæœ¬æ¨¡æ¿

```typescript
import { TestBed } from '@angular/core/testing';
import { ComponentFixture } from '@angular/core/testing';
import { ExampleComponent } from './example.component';

describe('ExampleComponent', () => {
  let component: ExampleComponent;
  let fixture: ComponentFixture<ExampleComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [ExampleComponent] // Standalone component
    }).compileComponents();

    fixture = TestBed.createComponent(ExampleComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });

  describe('åŠŸèƒ½æè¿°', () => {
    it('should æ¸¬è©¦æ¡ˆä¾‹æè¿°', () => {
      // Arrange
      const expectedValue = 'test';

      // Act
      component.doSomething();

      // Assert
      expect(component.value()).toBe(expectedValue);
    });
  });
});
```

## ğŸ“ æ¸¬è©¦å‘½åè¦ç¯„

### describe å€å¡Š
- ä½¿ç”¨å…ƒä»¶/æœå‹™çš„åç¨±
- ä½¿ç”¨å·¢ç‹€ describe çµ„ç¹”ç›¸é—œæ¸¬è©¦

```typescript
describe('UserService', () => {
  describe('loadUsers', () => {
    it('should load users successfully', () => { });
    it('should handle load error', () => { });
    it('should cache loaded users', () => { });
  });

  describe('updateUser', () => {
    it('should update user successfully', () => { });
    it('should validate user data', () => { });
  });
});
```

### it æ¸¬è©¦æ¡ˆä¾‹
- ä½¿ç”¨ "should + å‹•è©" æ ¼å¼
- æ¸…æ¥šæè¿°é æœŸè¡Œç‚º
- ä½¿ç”¨æ­£é«”ä¸­æ–‡æˆ–è‹±æ–‡ï¼ˆä¿æŒä¸€è‡´ï¼‰

```typescript
// âœ… å¥½çš„å‘½å
it('should display user name when logged in', () => { });
it('should show error message when login fails', () => { });
it('should disable submit button when form is invalid', () => { });

// âŒ ä¸å¥½çš„å‘½å
it('test user', () => { });
it('works', () => { });
it('æª¢æŸ¥', () => { });
```

## ğŸ§ª æ¸¬è©¦é¡å‹

### 1. å…ƒä»¶æ¸¬è©¦

#### åŸºæœ¬å…ƒä»¶æ¸¬è©¦
```typescript
describe('TaskComponent', () => {
  let component: TaskComponent;
  let fixture: ComponentFixture<TaskComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [TaskComponent, SHARED_IMPORTS]
    }).compileComponents();

    fixture = TestBed.createComponent(TaskComponent);
    component = fixture.componentInstance;
  });

  it('should display task title', () => {
    // ä½¿ç”¨ Signal inputs
    fixture.componentRef.setInput('task', { id: '1', title: 'Test Task' });
    fixture.detectChanges();

    const titleElement = fixture.nativeElement.querySelector('.task-title');
    expect(titleElement.textContent).toContain('Test Task');
  });

  it('should emit event when button clicked', () => {
    let emittedValue: string | undefined;

    // è¨‚é–± Signal output
    component.taskClicked.subscribe(value => {
      emittedValue = value;
    });

    const button = fixture.nativeElement.querySelector('button');
    button.click();

    expect(emittedValue).toBe('expected-value');
  });
});
```

#### æ¸¬è©¦ Signals
```typescript
describe('Component Signals', () => {
  it('should update signal state', () => {
    component.count.set(0);
    expect(component.count()).toBe(0);

    component.increment();
    expect(component.count()).toBe(1);
  });

  it('should compute derived state', () => {
    component.items.set([1, 2, 3]);
    expect(component.totalCount()).toBe(3);

    component.items.update(items => [...items, 4]);
    expect(component.totalCount()).toBe(4);
  });
});
```

### 2. æœå‹™æ¸¬è©¦

#### åŸºæœ¬æœå‹™æ¸¬è©¦
```typescript
describe('TaskService', () => {
  let service: TaskService;
  let httpMock: HttpTestingController;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [HttpClientTestingModule],
      providers: [TaskService]
    });

    service = TestBed.inject(TaskService);
    httpMock = TestBed.inject(HttpTestingController);
  });

  afterEach(() => {
    httpMock.verify();
  });

  it('should load tasks', async () => {
    const mockTasks = [
      { id: '1', title: 'Task 1' },
      { id: '2', title: 'Task 2' }
    ];

    const promise = service.loadTasks();

    const req = httpMock.expectOne('/api/tasks');
    expect(req.request.method).toBe('GET');
    req.flush(mockTasks);

    await promise;
    expect(service.tasks()).toEqual(mockTasks);
  });

  it('should handle load error', async () => {
    const promise = service.loadTasks();

    const req = httpMock.expectOne('/api/tasks');
    req.flush('Error', { status: 500, statusText: 'Server Error' });

    await expectAsync(promise).toBeRejected();
    expect(service.tasks()).toEqual([]);
  });
});
```

#### æ¸¬è©¦ Signals æœå‹™
```typescript
describe('DataService with Signals', () => {
  it('should update signal when data loaded', async () => {
    expect(service.data()).toEqual([]);

    await service.loadData();

    expect(service.data().length).toBeGreaterThan(0);
  });

  it('should compute filtered data', () => {
    service.setData([
      { id: '1', active: true },
      { id: '2', active: false }
    ]);

    expect(service.activeData()).toEqual([
      { id: '1', active: true }
    ]);
  });
});
```

### 3. æ•´åˆæ¸¬è©¦

```typescript
describe('Task Management Integration', () => {
  let taskService: TaskService;
  let userService: UserService;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [HttpClientTestingModule],
      providers: [TaskService, UserService]
    });

    taskService = TestBed.inject(TaskService);
    userService = TestBed.inject(UserService);
  });

  it('should load user tasks', async () => {
    // è¨­å®šä½¿ç”¨è€…
    userService.setUser({ id: 'user1', name: 'Test User' });

    // è¼‰å…¥ä»»å‹™
    await taskService.loadUserTasks('user1');

    // é©—è­‰çµæœ
    expect(taskService.tasks().length).toBeGreaterThan(0);
    expect(taskService.tasks().every(t => t.userId === 'user1')).toBe(true);
  });
});
```

## ğŸ¯ æ¸¬è©¦æ¶µè“‹ç¯„åœ

### å¿…é ˆæ¸¬è©¦çš„é …ç›®
1. **æˆåŠŸè·¯å¾‘**ï¼šåŠŸèƒ½æ­£å¸¸é‹ä½œ
2. **éŒ¯èª¤è™•ç†**ï¼šå„ç¨®éŒ¯èª¤æƒ…å¢ƒ
3. **é‚Šç•Œæƒ…æ³**ï¼šç©ºå€¼ã€æ¥µç«¯å€¼ã€é‚Šç•Œå€¼
4. **ç‹€æ…‹è®ŠåŒ–**ï¼šSignals å’Œç‹€æ…‹æ›´æ–°
5. **ä½¿ç”¨è€…äº’å‹•**ï¼šé»æ“Šã€è¼¸å…¥ã€äº‹ä»¶

### æ¸¬è©¦ç¯„ä¾‹

```typescript
describe('UserForm', () => {
  // æˆåŠŸè·¯å¾‘
  it('should submit valid form', () => {
    component.nameControl.setValue('John');
    component.emailControl.setValue('john@example.com');
    component.submit();
    expect(component.isSubmitted()).toBe(true);
  });

  // éŒ¯èª¤è™•ç†
  it('should show error for invalid email', () => {
    component.emailControl.setValue('invalid-email');
    component.emailControl.markAsTouched();
    fixture.detectChanges();

    const error = fixture.nativeElement.querySelector('.error-message');
    expect(error).toBeTruthy();
  });

  // é‚Šç•Œæƒ…æ³
  it('should handle empty form', () => {
    component.submit();
    expect(component.nameControl.invalid).toBe(true);
    expect(component.emailControl.invalid).toBe(true);
  });

  it('should handle very long input', () => {
    const longString = 'a'.repeat(1000);
    component.nameControl.setValue(longString);
    expect(component.nameControl.invalid).toBe(true);
  });

  // ç‹€æ…‹è®ŠåŒ–
  it('should disable submit during submission', async () => {
    component.nameControl.setValue('John');
    component.emailControl.setValue('john@example.com');

    const submitPromise = component.submit();
    expect(component.isSubmitting()).toBe(true);

    await submitPromise;
    expect(component.isSubmitting()).toBe(false);
  });
});
```

## ğŸ› ï¸ æ¸¬è©¦å·¥å…·å’ŒæŠ€å·§

### Mock æœå‹™
```typescript
const mockTaskService = {
  tasks: signal([]),
  loadTasks: jasmine.createSpy('loadTasks').and.returnValue(Promise.resolve())
};

TestBed.configureTestingModule({
  providers: [
    { provide: TaskService, useValue: mockTaskService }
  ]
});
```

### Spy ä½¿ç”¨
```typescript
it('should call service method', () => {
  const spy = spyOn(service, 'loadData').and.returnValue(Promise.resolve());

  component.refresh();

  expect(spy).toHaveBeenCalled();
  expect(spy).toHaveBeenCalledWith('param1', 'param2');
});
```

### ç•°æ­¥æ¸¬è©¦
```typescript
it('should handle async operation', async () => {
  await component.loadData();
  expect(component.data()).not.toEqual([]);
});

it('should handle async operation with fakeAsync', fakeAsync(() => {
  component.loadData();
  tick(1000);
  expect(component.data()).not.toEqual([]);
}));
```

## âœ… æ¸¬è©¦æœ€ä½³å¯¦è¸

### 1. AAA æ¨¡å¼
```typescript
it('should update task status', () => {
  // Arrange - æº–å‚™æ¸¬è©¦è³‡æ–™
  const task = { id: '1', title: 'Test', status: 'pending' };
  component.task.set(task);

  // Act - åŸ·è¡Œæ“ä½œ
  component.updateStatus('completed');

  // Assert - é©—è­‰çµæœ
  expect(component.task().status).toBe('completed');
});
```

### 2. æ¸¬è©¦éš”é›¢
- æ¯å€‹æ¸¬è©¦æ¡ˆä¾‹ç¨ç«‹
- ä¸ä¾è³´å…¶ä»–æ¸¬è©¦çš„çµæœ
- ä½¿ç”¨ beforeEach é‡ç½®ç‹€æ…‹

### 3. æ¸…æ™°çš„æ–·è¨€
```typescript
// âœ… æ¸…æ¥š
expect(component.items().length).toBe(3);
expect(component.title()).toBe('Expected Title');

// âŒ ä¸æ¸…æ¥š
expect(component.items()).toBeTruthy();
expect(component.title()).not.toBeFalsy();
```

### 4. é¿å…æ¸¬è©¦å¯¦ä½œç´°ç¯€
```typescript
// âœ… æ¸¬è©¦è¡Œç‚º
it('should display filtered items', () => {
  component.searchTerm.set('test');
  fixture.detectChanges();

  const items = fixture.nativeElement.querySelectorAll('.item');
  expect(items.length).toBe(expectedCount);
});

// âŒ æ¸¬è©¦å¯¦ä½œ
it('should call filterItems method', () => {
  const spy = spyOn(component, 'filterItems');
  component.search();
  expect(spy).toHaveBeenCalled();
});
```

## ğŸ“Š æ¸¬è©¦è¦†è“‹ç‡

### ç›®æ¨™
- æ•´é«”è¦†è“‹ç‡ â‰¥ 80%
- é—œéµè·¯å¾‘ 100% è¦†è“‹
- æ–°å¢ç¨‹å¼ç¢¼å¿…é ˆæœ‰æ¸¬è©¦

### æª¢æŸ¥è¦†è“‹ç‡
```bash
yarn test --code-coverage
```

### è¦†è“‹ç‡å ±å‘Š
- æª¢è¦– `coverage/index.html`
- é—œæ³¨æœªè¦†è“‹çš„åˆ†æ”¯å’Œèªå¥
- å„ªå…ˆè£œå……é—œéµåŠŸèƒ½çš„æ¸¬è©¦

## ğŸš« é¿å…çš„åæ¨¡å¼

### 1. éåº¦ Mock
```typescript
// âŒ Mock å¤ªå¤šï¼Œå¤±å»æ¸¬è©¦æ„ç¾©
spyOn(service, 'method1');
spyOn(service, 'method2');
spyOn(service, 'method3');
// ...
```

### 2. æ¸¬è©¦éæ–¼è¤‡é›œ
```typescript
// âŒ ä¸€å€‹æ¸¬è©¦åšå¤ªå¤šäº‹
it('should do everything', () => {
  // 50 è¡Œçš„æ¸¬è©¦é‚è¼¯
});

// âœ… æ‹†åˆ†æˆå¤šå€‹æ¸¬è©¦
it('should do task 1', () => { });
it('should do task 2', () => { });
```

### 3. ç¡¬ç·¨ç¢¼æ¸¬è©¦è³‡æ–™
```typescript
// âŒ é›£ä»¥ç¶­è­·
expect(component.items()[0].id).toBe('abc-123-def');

// âœ… ä½¿ç”¨æœ‰æ„ç¾©çš„æ¸¬è©¦è³‡æ–™
const testItem = createTestItem({ id: 'test-1' });
expect(component.items()[0].id).toBe(testItem.id);
```

## ğŸ“š åƒè€ƒè³‡æº

- [Angular Testing Guide](https://angular.dev/guide/testing)
- [Jasmine Documentation](https://jasmine.github.io/)
- å°ˆæ¡ˆæ¸¬è©¦è¦ç¯„ï¼š`.cursor/rules/testing.mdc`
- æ¸¬è©¦ç¯„ä¾‹ï¼š`src/**/*.spec.ts`

- --

**ç‰ˆæœ¬**ï¼šv2.0
**æœ€å¾Œæ›´æ–°**ï¼š2025-11-18
**ç¶­è­·è€…**ï¼šé–‹ç™¼åœ˜éšŠ
