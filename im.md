# 📐 企業級專案管理系統 - 完整架構設計圖


```
═══════════════════════════════════════════════════════════════════════════════
                              【基礎層 - FOUNDATION LAYER】
                                   帳戶體系架構
═══════════════════════════════════════════════════════════════════════════════

                          ┌─────────────────────────┐
                          │   Identity Provider     │
                          │   (Supabase Auth)       │
                          │  • Email/Password       │
                          │  • OAuth (Google/MS)    │
                          │  • SSO (Enterprise)     │
                          └────────────┬────────────┘
                                       │
                    ┌──────────────────┼──────────────────┐
                    ↓                  ↓                  ↓
                                                          
        ┏━━━━━━━━━━━━━━━━━━┓  ┏━━━━━━━━━━━━━━━━━━┓  ┏━━━━━━━━━━━━━━━━━━┓
        ┃   用戶 (User)     ┃  ┃ 組織 (Organization)┃  ┃ 訂閱計費系統      ┃
        ┃   [基本身份單位]   ┃  ┃ [企業/團隊主體]     ┃  ┃ [商業模式層]      ┃
        ┗━━━━━━━━━━━━━━━━━━┛  ┗━━━━━━━━━━━━━━━━━━┛  ┗━━━━━━━━━━━━━━━━━━┛
        ┃                   ┃  ┃                   ┃  ┃                   ┃
        ┃ 核心屬性:          ┃  ┃ 核心屬性:          ┃  ┃ 方案層級:          ┃
        ┃ • UUID            ┃  ┃ • UUID            ┃  ┃ ┌───────────────┐ ┃
        ┃ • Email (唯一)     ┃  ┃ • Name            ┃  ┃ │ Free 免費版    │ ┃
        ┃ • Display Name    ┃  ┃ • Slug (網址識別)  ┃  ┃ │ • 1個藍圖      │ ┃
        ┃ • Avatar          ┃  ┃ • Logo            ┃  ┃ │ • 5個成員      │ ┃
        ┃ • Timezone        ┃  ┃ • Industry        ┃  ┃ │ • 1GB儲存     │ ┃
        ┃ • Language        ┃  ┃ • Founded Date    ┃  ┃ └───────────────┘ ┃
        ┃ • Status          ┃  ┃ • Status          ┃  ┃ ┌───────────────┐ ┃
        ┃   - Active        ┃  ┃   - Active        ┃  ┃ │ Pro 專業版     │ ┃
        ┃   - Suspended     ┃  ┃   - Trial         ┃  ┃ │ • 10個藍圖     │ ┃
        ┃   - Deleted       ┃  ┃   - Suspended     ┃  ┃ │ • 50個成員     │ ┃
        ┃                   ┃  ┃                   ┃  ┃ │ • 100GB儲存   │ ┃
        ┃ 權限範圍:          ┃  ┃ 計費主體:          ┃  ┃ │ • 進階功能     │ ┃
        ┃ ✅ 建立個人藍圖    ┃  ┃ • Payment Method  ┃  ┃ └───────────────┘ ┃
        ┃ ✅ 加入組織        ┃  ┃ • Billing Cycle   ┃  ┃ ┌───────────────┐ ┃
        ┃ ✅ 接受協作邀請    ┃  ┃ • Invoice History ┃  ┃ │ Enterprise版  │ ┃
        ┃ ❌ 建立組織藍圖    ┃  ┃                   ┃  ┃ │ • 無限藍圖     │ ┃
        ┃   (需透過組織)     ┃  ┃ 配額管理:          ┃  ┃ │ • 無限成員     │ ┃
        ┗━━━━━━━━━━━━━━━━━━┛  ┃ • Max Blueprints  ┃  ┃ │ • 1TB儲存     │ ┃
                 │             ┃ • Max Members     ┃  ┃ │ • SSO整合     │ ┃
                 │             ┃ • Storage Quota   ┃  ┃ │ • 專屬支援     │ ┃
                 │             ┃ • API Rate Limit  ┃  ┃ │ • SLA保證     │ ┃
                 │             ┗━━━━━━━━━━━━━━━━━━┛  ┗━━━━━━━━━━━━━━━━━━┛
                 │                      │                       │
                 │                      │                       │
                 └──────────────────────┼───────────────────────┘
                                        │
                    ┌───────────────────┼───────────────────┐
                    ↓                   ↓                   ↓
                                                            
    ┏━━━━━━━━━━━━━━━━━━━━━┓  ┏━━━━━━━━━━━━━━━━━━┓  ┏━━━━━━━━━━━━━━━━━━┓
    ┃ 組織成員              ┃  ┃ 團隊 (Team)       ┃  ┃ BOT用戶           ┃
    ┃ (Organization Member) ┃  ┃ [組織子單位]       ┃  ┃ (Bot User)       ┃
    ┃ [用戶⇄組織關聯]        ┃  ┃ [權限分組機制]     ┃  ┃ [自動化執行者]    ┃
    ┗━━━━━━━━━━━━━━━━━━━━━┛  ┗━━━━━━━━━━━━━━━━━━┛  ┗━━━━━━━━━━━━━━━━━━┛
    ┃                      ┃  ┃                   ┃  ┃                   ┃
    ┃ 關聯關係:             ┃  ┃ 本質定位:          ┃  ┃ 技術屬性:          ┃
    ┃ User ←→ Organization ┃  ┃ • 歸屬於組織       ┃  ┃ • Service Account ┃
    ┃ (多對多)              ┃  ┃ • 成員來自組織     ┃  ┃ • API Token Auth  ┃
    ┃                      ┃  ┃ • 不獨立存在       ┃  ┃ • Non-Interactive ┃
    ┃ 組織角色 (4層):       ┃  ┃                   ┃  ┃ • Event Driven    ┃
    ┃ ┌──────────────────┐ ┃  ┃ 使用場景:          ┃  ┃                   ┃
    ┃ │ Owner 擁有者      │ ┃  ┃ • 研發部          ┃  ┃ 使用場景:          ┃
    ┃ │ ───────────────  │ ┃  ┃ • 設計部          ┃  ┃ • 定時任務         ┃
    ┃ │ • 最高權限        │ ┃  ┃ • 行銷部          ┃  ┃ • 資料同步         ┃
    ┃ │ • 刪除組織        │ ┃  ┃ • 專案組          ┃  ┃ • Webhook觸發     ┃
    ┃ │ • 轉讓擁有權      │ ┃  ┃ • 區域分支        ┃  ┃ • 第三方整合       ┃
    ┃ │ • 計費管理        │ ┃  ┃ • 臨時任務組      ┃  ┃   - Slack         ┃
    ┃ │ • 全局設定        │ ┃  ┃                   ┃  ┃   - GitHub        ┃
    ┃ └──────────────────┘ ┃  ┃ 團隊角色 (2層):    ┃  ┃   - Jira          ┃
    ┃ ┌──────────────────┐ ┃  ┃ ┌───────────────┐ ┃  ┃   - Google Cal    ┃
    ┃ │ Admin 管理員      │ ┃  ┃ │ Leader 領導   │ ┃  ┃                   ┃
    ┃ │ ───────────────  │ ┃  ┃ │ ────────────  │ ┃  ┃ 權限模型:          ┃
    ┃ │ • 成員管理        │ ┃  ┃ │ • 管理成員    │ ┃  ┃ • Scope-based     ┃
    ┃ │ • 建立藍圖        │ ┃  ┃ │ • 分配任務    │ ┃  ┃ • Fine-grained    ┃
    ┃ │ • 建立團隊        │ ┃  ┃ │ • 設定目標    │ ┃  ┃ • Revocable       ┃
    ┃ │ • 配置BOT        │ ┃  ┃ └───────────────┘ ┃  ┃                   ┃
    ┃ │ • 邀請協作者      │ ┃  ┃ ┌───────────────┐ ┃  ┃ 權限範圍:          ┃
    ┃ └──────────────────┘ ┃  ┃ │ Member 成員   │ ┃  ┃ ✅ 讀取資源        ┃
    ┃ ┌──────────────────┐ ┃  ┃ │ ────────────  │ ┃  ┃ ✅ 建立資源        ┃
    ┃ │ Member 成員       │ ┃  ┃ │ • 參與協作    │ ┃  ┃ ✅ 更新資源        ┃
    ┃ │ ───────────────  │ ┃  ┃ │ • 執行任務    │ ┃  ┃ ✅ 觸發事件        ┃
    ┃ │ • 使用藍圖        │ ┃  ┃ │ • 報告進度    │ ┃  ┃ ✅ 發送通知        ┃
    ┃ │ • 加入團隊        │ ┃  ┃ └───────────────┘ ┃  ┃ ❌ 建立藍圖        ┃
    ┃ │ • 建立內容        │ ┃  ┃                   ┃  ┃ ❌ 管理成員        ┃
    ┃ │ • 參與協作        │ ┃  ┃ 重要限制:          ┃  ┃ ❌ 修改權限        ┃
    ┃ └──────────────────┘ ┃  ┃ ❌ 團隊不能建立藍圖 ┃  ┃                   ┃
    ┃ ┌──────────────────┐ ┃  ┃ ✅ 但可管理藍圖    ┃  ┃ 審計追蹤:          ┃
    ┃ │ Guest 訪客        │ ┃  ┃ ✅ 成員批量加入    ┃  ┃ • 操作日誌         ┃
    ┃ │ ───────────────  │ ┃  ┃                   ┃  ┃ • Token使用記錄    ┃
    ┃ │ • 受限訪問        │ ┃  ┃ 成員關係:          ┃  ┃ • 異常偵測         ┃
    ┃ │ • 特定藍圖        │ ┃  ┃ Team Members ⊆    ┃  ┃ • 自動禁用機制     ┃
    ┃ │ • 唯讀為主        │ ┃  ┃ Org Members       ┃  ┗━━━━━━━━━━━━━━━━━━┛
    ┃ └──────────────────┘ ┃  ┃ (團隊成員必須是    ┃           │
    ┃                      ┃  ┃  組織成員)         ┃           │
    ┃ 成員狀態:             ┃  ┗━━━━━━━━━━━━━━━━━━┛           │
    ┃ • Active (活躍)       ┃           │                      │
    ┃ • Pending (待加入)    ┃           │                      │
    ┃ • Suspended (停用)   ┃           │                      │
    ┗━━━━━━━━━━━━━━━━━━━━━┛           │                      │
                 │                      │                      │
                 └──────────────────────┴──────────────────────┘
                                        │
                            ┌───────────┴───────────┐
                            ↓                       ↓
                                                    
            ┏━━━━━━━━━━━━━━━━━━━━━┓      ┏━━━━━━━━━━━━━━━━━━━━━┓
            ┃ 協作者 (Collaborator) ┃      ┃ 權限繼承鏈 (RBAC)    ┃
            ┃ [外部參與者]          ┃      ┃ [多層級權限模型]      ┃
            ┗━━━━━━━━━━━━━━━━━━━━━┛      ┗━━━━━━━━━━━━━━━━━━━━━┛
            ┃                      ┃      ┃                      ┃
            ┃ 本質定義:             ┃      ┃ 層級結構:             ┃
            ┃ • 非組織成員          ┃      ┃                      ┃
            ┃ • 受邀參與            ┃      ┃ ┌──────────────────┐ ┃
            ┃ • 臨時訪問            ┃      ┃ │ 第1層: 組織層     │ ┃
            ┃ • 範圍受限            ┃      ┃ │ ────────────────  │ ┃
            ┃                      ┃      ┃ │ Organization Role │ ┃
            ┃ 典型場景:             ┃      ┃ │ • Owner          │ ┃
            ┃ ┌──────────────────┐ ┃      ┃ │ • Admin          │ ┃
            ┃ │ 客戶方            │ ┃      ┃ │ • Member         │ ┃
            ┃ │ • 查看專案進度    │ ┃      ┃ │ • Guest          │ ┃
            ┃ │ • 審核交付成果    │ ┃      ┃ └─────────┬────────┘ ┃
            ┃ │ • 提供反饋        │ ┃      ┃           ↓          ┃
            ┃ └──────────────────┘ ┃      ┃ ┌──────────────────┐ ┃
            ┃ ┌──────────────────┐ ┃      ┃ │ 第2層: 團隊層     │ ┃
            ┃ │ 供應商/承包商     │ ┃      ┃ │ ────────────────  │ ┃
            ┃ │ • 協作開發        │ ┃      ┃ │ Team Role        │ ┃
            ┃ │ • 上傳交付物      │ ┃      ┃ │ • Leader         │ ┃
            ┃ │ • 技術對接        │ ┃      ┃ │ • Member         │ ┃
            ┃ └──────────────────┘ ┃      ┃ └─────────┬────────┘ ┃
            ┃ ┌──────────────────┐ ┃      ┃           ↓          ┃
            ┃ │ 外部顧問          │ ┃      ┃ ┌──────────────────┐ ┃
            ┃ │ • 提供建議        │ ┃      ┃ │ 第3層: 藍圖層     │ ┃
            ┃ │ • 審查文件        │ ┃      ┃ │ ────────────────  │ ┃
            ┃ │ • 有限期限        │ ┃      ┃ │ Blueprint Role   │ ┃
            ┃ └──────────────────┘ ┃      ┃ │ • Owner          │ ┃
            ┃ ┌──────────────────┐ ┃      ┃ │ • Admin          │ ┃
            ┃ │ 臨時合作夥伴      │ ┃      ┃ │ • Member         │ ┃
            ┃ │ • 短期專案        │ ┃      ┃ │ • Viewer         │ ┃
            ┃ │ • 特定功能        │ ┃      ┃ └─────────┬────────┘ ┃
            ┃ │ • 到期自動移除    │ ┃      ┃           ↓          ┃
            ┃ └──────────────────┘ ┃      ┃ ┌──────────────────┐ ┃
            ┃                      ┃      ┃ │ 第4層: 資源層     │ ┃
            ┃ 權限模型:             ┃      ┃ │ ────────────────  │ ┃
            ┃ • Viewer (唯讀)       ┃      ┃ │ Resource Access  │ ┃
            ┃   - 查看內容          ┃      ┃ │ • Creator        │ ┃
            ┃   - 匯出報表          ┃      ┃ │ • Assignee       │ ┃
            ┃   - 下載檔案          ┃      ┃ │ • Reviewer       │ ┃
            ┃                      ┃      ┃ │ • Viewer         │ ┃
            ┃ • Member (編輯)       ┃      ┃ └──────────────────┘ ┃
            ┃   - 建立內容          ┃      ┃                      ┃
            ┃   - 編輯資料          ┃      ┃ 計算規則:             ┃
            ┃   - 上傳檔案          ┃      ┃ ┌──────────────────┐ ┃
            ┃                      ┃      ┃ │ 取最嚴格限制      │ ┃
            ┃ 訪問控制:             ┃      ┃ │ ────────────────  │ ┃
            ┃ • 僅限受邀藍圖        ┃      ┃ │ 1. 上層限制下層  │ ┃
            ┃ • 設定有效期限        ┃      ┃ │ 2. 同層取交集    │ ┃
            ┃ • 可隨時撤銷          ┃      ┃ │ 3. 明確拒絕優先  │ ┃
            ┃ • 操作全程記錄        ┃      ┃ │ 4. 無權限=拒絕   │ ┃
            ┃                      ┃      ┃ └──────────────────┘ ┃
            ┃ 安全限制:             ┃      ┃                      ┃
            ┃ ❌ 看不到組織結構     ┃      ┃ 特殊規則:             ┃
            ┃ ❌ 無法邀請他人       ┃      ┃ • Owner可覆寫       ┃
            ┃ ❌ 無法建立藍圖       ┃      ┃ • 創建者預設有權限   ┃
            ┃ ❌ 無法修改權限       ┃      ┃ • BOT繼承組織權限   ┃
            ┃ ✅ 僅限邀請範圍      ┃      ┃ • 協作者獨立計算     ┃
            ┗━━━━━━━━━━━━━━━━━━━━━┛      ┗━━━━━━━━━━━━━━━━━━━━━┛

═══════════════════════════════════════════════════════════════════════════════
                         【容器層 - CONTAINER LAYER】
                              藍圖系統 (Blueprint)
                         「邏輯隔離的工作空間容器」
═══════════════════════════════════════════════════════════════════════════════

                    ┌────────────────────────────────┐
                    │     誰能建立藍圖容器？           │
                    ├────────────────────────────────┤
                    │                                │
                    │  ✅ 組織 (Organization)        │
                    │     ↳ 建立組織藍圖              │
                    │     ↳ 計費歸屬組織              │
                    │     ↳ 配額計算到組織            │
                    │     ↳ 成員來自組織/團隊         │
                    │                                │
                    │  ✅ 用戶 (User)                │
                    │     ↳ 建立個人藍圖              │
                    │     ↳ 計費歸屬個人              │
                    │     ↳ 可轉移給組織              │
                    │     ↳ 僅自己可訪問              │
                    │                                │
                    │  ❌ 團隊 (Team)                │
                    │     ↳ 不能直接建立              │
                    │     ↳ 但可被指派管理權          │
                    │     ↳ 成員可批量加入            │
                    │                                │
                    │  ❌ BOT用戶                    │
                    │     ↳ BOT不能建立              │
                    │     ↳ 但可執行操作              │
                    │     ↳ 受權限範圍限制            │
                    │                                │
                    │  ❌ 協作者 (Collaborator)      │
                    │     ↳ 協作者不能建立            │
                    │     ↳ 只能被邀請參與            │
                    │     ↳ 僅限受邀藍圖              │
                    │                                │
                    └────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    ↓                               ↓

    ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┓       ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
    ┃   組織藍圖                 ┃       ┃   個人藍圖                 ┃
    ┃   (Organization Blueprint) ┃       ┃   (Personal Blueprint)     ┃
    ┃   [企業級協作空間]          ┃       ┃   [個人工作空間]            ┃
    ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━┛       ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
    ┃                            ┃       ┃                            ┃
    ┃ 擁有者: Organization        ┃       ┃ 擁有者: User                ┃
    ┃                            ┃       ┃                            ┃
    ┃ 成員來源:                   ┃       ┃ 成員來源:                   ┃
    ┃ ┌────────────────────────┐ ┃       ┃ • 僅用戶本人                ┃
    ┃ │ 內部成員               │ ┃       ┃ • 受邀協作者 (可選)          ┃
    ┃ │ • 組織成員 (自動繼承)   │ ┃       ┃                            ┃
    ┃ │ • 團隊成員 (批量加入)   │ ┃       ┃ 使用場景:                   ┃
    ┃ │ • 權限可額外授予        │ ┃       ┃ ┌────────────────────────┐ ┃
    ┃ └────────────────────────┘ ┃       ┃ │ 個人練習專案            │ ┃
    ┃ ┌────────────────────────┐ ┃       ┃ │ • 學習新技術            │ ┃
    ┃ │ 外部協作者              │ ┃       ┃ │ • 技能訓練              │ ┃
    ┃ │ • 客戶                 │ ┃       ┃ └────────────────────────┘ ┃
    ┃ │ • 供應商               │ ┃       ┃ ┌────────────────────────┐ ┃
    ┃ │ • 顧問                 │ ┃       ┃ │ 副業專案                │ ┃
    ┃ │ • 臨時合作夥伴          │ ┃       ┃ │ • 個人接案              │ ┃
    ┃ └────────────────────────┘ ┃       ┃ │ • 創意實驗              │ ┃
    ┃ ┌────────────────────────┐ ┃       ┃ └────────────────────────┘ ┃
    ┃ │ BOT用戶                │ ┃       ┃ ┌────────────────────────┐ ┃
    ┃ │ • 自動化執行            │ ┃       ┃ │ 個人知識庫              │ ┃
    ┃ │ • 系統整合              │ ┃       ┃ │ • 筆記整理              │ ┃
    ┃ └────────────────────────┘ ┃       ┃ │ • 資料收集              │ ┃
    ┃                            ┃       ┃ └────────────────────────┘ ┃
    ┃ 典型場景:                   ┃       ┃                            ┃
    ┃ ┌────────────────────────┐ ┃       ┃ 轉移機制:                   ┃
    ┃ │ 公司專案               │ ┃       ┃ ┌────────────────────────┐ ┃
    ┃ │ • 產品開發             │ ┃       ┃ │ 個人 → 組織轉移         │ ┃
    ┃ │ • 客戶交付             │ ┃       ┃ │ ────────────────────   │ ┃
    ┃ │ • 內部系統             │ ┃       ┃ │ 1. 用戶發起轉移請求     │ ┃
    ┃ └────────────────────────┘ ┃       ┃ │ 2. 選擇目標組織         │ ┃
    ┃ ┌────────────────────────┐ ┃       ┃ │ 3. 組織Owner確認       │ ┃
    ┃ │ 部門專案               │ ┃       ┃ │ 4. 轉為組織藍圖         │ ┃
    ┃ │ • 行銷活動             │ ┃       ┃ │ 5. 原用戶成為Admin     │ ┃
    ┃ │ • 研發計畫             │ ┃       ┃ │ 6. 計費主體變更         │ ┃
    ┃ │ • 業務拓展             │ ┃       ┃ └────────────────────────┘ ┃
    ┃ └────────────────────────┘ ┃       ┃                            ┃
    ┃ ┌────────────────────────┐ ┃       ┃ 限制:                       ┃
    ┃ │ 跨組織協作             │ ┃       ┃ • 不可逆轉移                ┃
    ┃ │ • 聯合專案             │ ┃       ┃ • 需組織有配額              ┃
    ┃ │ • 策略合作             │ ┃       ┃ • 資料完整遷移              ┃
    ┃ └────────────────────────┘ ┃       ┃                            ┃
    ┃                            ┃       ┃ 計費: 個人訂閱方案          ┃
    ┃ 計費: 組織訂閱方案          ┃       ┃ 配額: 個人方案限制          ┃
    ┃ 配額: 組織方案限制          ┃       ┃ 儲存: 個人儲存空間          ┃
    ┃ 儲存: 組織儲存池            ┃       ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
    ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

                    ┌────────────────────────────────┐
                    │      藍圖成員角色系統           │
                    │    (Blueprint Member Roles)    │
                    ├────────────────────────────────┤
                    │                                │
                    │  ┌──────────────────────────┐  │
                    │  │ Owner 擁有者              │  │
                    │  │ ────────────────────────  │  │
                    │  │ 完全控制權:               │  │
                    │  │ ✅ 刪除藍圖               │  │
                    │  │ ✅ 轉移擁有權             │  │
                    │  │ ✅ 修改藍圖設定           │  │
                    │  │ ✅ 管理所有成員           │  │
                    │  │ ✅ 配置所有模組           │  │
                    │  │ ✅ 查看審計日誌           │  │
                    │  │ ✅ 匯出所有資料           │  │
                    │  │                          │  │
                    │  │ 來源:                    │  │
                    │  │ • 建立者自動成為Owner     │  │
                    │  │ • Owner只能有1人         │  │
                    │  │ • 可轉讓給其他Admin      │  │
                    │  └──────────────────────────┘  │
                    │                                │
                    │  ┌──────────────────────────┐  │
                    │  │ Admin 管理員              │  │
                    │  │ ────────────────────────  │  │
                    │  │ 管理權限:                 │  │
                    │  │ ✅ 邀請/移除成員          │  │
                    │  │ ✅ 設定成員權限           │  │
                    │  │ ✅ 配置模組功能           │  │
                    │  │ ✅ 管理團隊指派           │  │
                    │  │ ✅ 設定工作流程           │  │
                    │  │ ✅ 查看所有內容           │  │
                    │  │ ✅ 匯出報表               │  │
                    │  │ ❌ 刪除藍圖               │  │
                    │  │ ❌ 轉移擁有權             │  │
                    │  │                          │  │
                    │  │ 來源:                    │  │
                    │  │ • 組織Admin自動繼承      │  │
                    │  │ • Owner手動授予          │  │
                    │  │ • 團隊Leader可授予       │  │
                    │  │ • 可有多位Admin          │  │
                    │  └──────────────────────────┘  │
                    │                                │
                    │  ┌──────────────────────────┐  │
                    │  │ Member 成員               │  │
                    │  │ ────────────────────────  │  │
                    │  │ 協作權限:                 │  │
                    │  │ ✅ 建立任務/日誌/待辦     │  │
                    │  │ ✅ 編輯自己的內容         │  │
                    │  │ ✅ 查看團隊內容           │  │
                    │  │ ✅ 上傳/下載檔案          │  │
                    │  │ ✅ 評論與討論             │  │
                    │  │ ✅ 接收通知               │  │
                    │  │ ✅ 標記完成狀態           │  │
                    │  │ ⚠️  編輯他人內容(限制)    │  │
                    │  │ ❌ 刪除他人內容           │  │
                    │  │ ❌ 邀請新成員             │  │
                    │  │ ❌ 修改權限               │  │
                    │  │                          │  │
                    │  │ 來源:                    │  │
                    │  │ • 組織/團隊成員預設角色   │  │
                    │  │ • 大部分用戶的角色        │  │
                    │  │ • 日常協作主力            │  │
                    │  └──────────────────────────┘  │
                    │                                │
                    │  ┌──────────────────────────┐  │
                    │  │ Viewer 檢視者             │  │
                    │  │ ────────────────────────  │  │
                    │  │ 唯讀權限:                 │  │
                    │  │ ✅ 查看所有內容           │  │
                    │  │ ✅ 搜尋與篩選             │  │
                    │  │ ✅ 匯出個人報表           │  │
                    │  │ ✅ 下載檔案               │  │
                    │  │ ✅ 查看時間軸             │  │
                    │  │ ⚠️  評論(僅限查看)        │  │
                    │  │ ❌ 建立任何內容           │  │
                    │  │ ❌ 編輯資料               │  │
                    │  │ ❌ 上傳檔案               │  │
                    │  │ ❌ 修改狀態               │  │
                    │  │                          │  │
                    │  │ 來源:                    │  │
                    │  │ • 外部協作者預設角色      │  │
                    │  │ • 客戶/稽核人員           │  │
                    │  │ • 唯讀BOT                │  │
                    │  └──────────────────────────┘  │
                    │                                │
                    └────────────────────────────────┘

        ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
        ┃            藍圖容器層 - 12項核心基礎設施                      ┃
        ┃        (所有業務模組共享的容器層能力)                         ┃
        ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                                       │
        ┌──────────────────────────────┼──────────────────────────────┐
        ↓                              ↓                              ↓

┏━━━━━━━━━━━━━━━━━━━━┓  ┏━━━━━━━━━━━━━━━━━━━━┓  ┏━━━━━━━━━━━━━━━━━━━━┓
┃ 1. 上下文注入系統    ┃  ┃ 5. 事件總線系統      ┃  ┃ 9. 生命週期管理      ┃
┃ (Context Injection) ┃  ┃ (Event Bus)         ┃  ┃ (Lifecycle)         ┃
┗━━━━━━━━━━━━━━━━━━━━┛  ┗━━━━━━━━━━━━━━━━━━━━┛  ┗━━━━━━━━━━━━━━━━━━━━┛
┃                     ┃  ┃                     ┃  ┃                     ┃
┃ 核心職責:            ┃  ┃ 核心職責:            ┃  ┃ 狀態定義:            ┃
┃ 當用戶進入藍圖時    ┃  ┃ 模組間解耦通訊      ┃  ┃ • Draft (草稿)       ┃
┃ 自動注入上下文資訊  ┃  ┃ 事件驅動架構        ┃  ┃ • Active (活躍)      ┃
┃                     ┃  ┃                     ┃  ┃ • Archived (封存)    ┃
┃ 注入內容:            ┃  ┃ 事件類型:            ┃  ┃ • Deleted (刪除)     ┃
┃ ┌─────────────────┐ ┃  ┃ ┌─────────────────┐ ┃  ┃                     ┃
┃ │ Blueprint Info  │ ┃  ┃ │ 系統事件         │ ┃  ┃ 轉換規則:            ┃
┃ │ • ID            │ ┃  ┃ │ • 藍圖建立       │ ┃  ┃ Draft → Active       ┃
┃ │ • Name          │ ┃  ┃ │ • 成員加入       │ ┃  ┃ Active → Archived    ┃
┃ │ • Owner         │ ┃  ┃ │ • 權限變更       │ ┃  ┃ Archived → Active    ┃
┃ │ • Status        │ ┃  ┃ │ • 配置更新       │ ┃  ┃ Any → Deleted        ┃
┃ │ • Settings      │ ┃  ┃ └─────────────────┘ ┃  ┃                     ┃
┃ └─────────────────┘ ┃  ┃ ┌─────────────────┐ ┃  ┃ 資料保留政策:        ┃
┃ ┌─────────────────┐ ┃  ┃ │ 業務事件         │ ┃  ┃ • Active: 永久      ┃
┃ │ Current User    │ ┃  ┃ │ • 任務建立       │ ┃  ┃ • Archived: 永久    ┃
┃ │ • User ID       │ ┃  ┃ │ • 狀態變更       │ ┃  ┃ • Deleted: 30天     ┃
┃ │ • Name          │ ┃  ┃ │ • 檔案上傳       │ ┃  ┃   (軟刪除)          ┃
┃ │ • Avatar        │ ┃  ┃ │ • 評論新增       │ ┃  ┃ • 30天後: 永久刪除  ┃
┃ └─────────────────┘ ┃  ┃ └─────────────────┘ ┃  ┃                     ┃
┃ ┌─────────────────┐ ┃  ┃ ┌─────────────────┐ ┃  ┃ 操作權限:            ┃
┃ │ Permissions     │ ┃  ┃ │ 整合事件         │ ┃  ┃ • Draft: Owner      ┃
┃ │ • Role          │ ┃  ┃ │ • Webhook觸發   │ ┃  ┃ • Active: Admin+    ┃
┃ │ • Capabilities  │ ┃  ┃ │ • API調用       │ ┃  ┃ • Archive: Admin+   ┃
┃ │ • Restrictions  │ ┃  ┃ │ • 排程任務       │ ┃  ┃ • Delete: Owner     ┃
┃ └─────────────────┘ ┃  ┃ │ • 通知推送       │ ┃  ┗━━━━━━━━━━━━━━━━━━━━┛
┃ ┌─────────────────┐ ┃  ┃ └─────────────────┘ ┃
┃ │ Config          │ ┃  ┃                     ┃  ┏━━━━━━━━━━━━━━━━━━━━┓
┃ │ • Timezone      │ ┃  ┃ 發布/訂閱機制:       ┃  ┃ 10. 配置中心         ┃
┃ │ • Language      │ ┃  ┃ ┌─────────────────┐ ┃  ┃ (Configuration)     ┃
┃ │ • Work Hours    │ ┃  ┃ │ 模組發布事件     │ ┃  ┗━━━━━━━━━━━━━━━━━━━━┛
┃ │ • Date Format   │ ┃  ┃ │      ↓          │ ┃  ┃                     ┃
┃ └─────────────────┘ ┃  ┃ │   事件總線       │ ┃  ┃ 藍圖級配置:          ┃
┃                     ┃  ┃ │      ↓          │ ┃  ┃ ┌─────────────────┐ ┃
┃ 使用方式:            ┃  ┃ │ 路由到訂閱者     │ ┃  ┃ │ 工作時間設定     │ ┃
┃ • 所有模組自動繼承  ┃  ┃ │      ↓          │ ┃  ┃ │ • 每週工作日     │ ┃
┃ • 不需要重複查詢    ┃  ┃ │ 訂閱模組響應     │ ┃  ┃ │ • 工作時段       │ ┃
┃ • RxJS Observable   ┃  ┃ └─────────────────┘ ┃  ┃ │ • 休息時間       │ ┃
┃ • 響應式更新        ┃  ┃                     ┃  ┃ │ • 假日設定       │ ┃
┗━━━━━━━━━━━━━━━━━━━━┛  ┃ 事件過濾:            ┃  ┃ └─────────────────┘ ┃
                        ┃ • 訂閱特定類型      ┃  ┃ ┌─────────────────┐ ┃
┏━━━━━━━━━━━━━━━━━━━━┓  ┃ • 訂閱特定資源      ┃  ┃ │ 狀態定義         │ ┃
┃ 2. 權限系統          ┃  ┃ • 條件訂閱          ┃  ┃ │ • 待處理         │ ┃
┃ (Permission System) ┃  ┃ • 優先級控制        ┃  ┃ │ • 進行中         │ ┃
┗━━━━━━━━━━━━━━━━━━━━┛  ┃                     ┃  ┃ │ • 已完成         │ ┃
┃                     ┃  ┃ 解耦優勢:            ┃  ┃ │ • 已取消         │ ┃
┃ 身份驗證:            ┃  ┃ • 模組不直接調用    ┃  ┃ │ • 自訂狀態...    │ ┃
┃ • Firebase Auth     ┃  ┃ • 新模組易於整合    ┃  ┃ └─────────────────┘ ┃
┃ • OAuth 2.0         ┃  ┃ • 可隨時增減訂閱    ┃  ┃ ┌─────────────────┐ ┃
┃ • API Token (BOT)   ┃  ┃ • 容易測試與維護    ┃  ┃ │ 優先級定義       │ ┃
┃                     ┃  ┗━━━━━━━━━━━━━━━━━━━━┛  ┃ │ • 緊急 (P0)      │ ┃
┃ 角色定義框架:        ┃                          ┃ │ • 高 (P1)        │ ┃
┃ • 藍圖層角色        ┃  ┏━━━━━━━━━━━━━━━━━━━━┓  ┃ │ • 中 (P2)        │ ┃
┃ • 資源層權限        ┃  ┃ 6. 搜尋引擎系統      ┃  ┃ │ • 低 (P3)        │ ┃
┃ • 動態權限計算      ┃  ┃ (Search Engine)     ┃  ┃ └─────────────────┘ ┃
┃                     ┃  ┗━━━━━━━━━━━━━━━━━━━━┛  ┃ ┌─────────────────┐ ┃
┃ 權限檢查流程:        ┃  ┃                     ┃  ┃ │ 標籤體系         │ ┃
┃ 1. 身份識別         ┃  ┃ 核心功能:            ┃  ┃ │ • 系統標籤       │ ┃
┃ 2. 角色確認         ┃  ┃ 跨模組全文檢索      ┃  ┃ │ • 自訂標籤       │ ┃
┃ 3. 權限計算         ┃  ┃ 統一索引管理        ┃  ┃ │ • 標籤顏色       │ ┃
┃ 4. 快取結果         ┃  ┃                     ┃  ┃ │ • 標籤分組       │ ┃
┃ 5. 返回判斷         ┃  ┃ 搜尋類型:            ┃  ┃ └─────────────────┘ ┃
┃                     ┃  ┃ ┌─────────────────┐ ┃  ┃ ┌─────────────────┐ ┃
┃ 快取策略:            ┃  ┃ │ 全文搜尋         │ ┃  ┃ │ 通知設定         │ ┃
┃ • 用戶級快取        ┃  ┃ │ • 標題           │ ┃  ┃ │ • 勿擾時段       │ ┃
┃ • 藍圖級快取        ┃  ┃ │ • 描述           │ ┃  ┃ │ • 通知頻率       │ ┃
┃ • 權限變更時清除    ┃  ┃ │ • 內容           │ ┃  ┃ │ • 通知渠道       │ ┃
┗━━━━━━━━━━━━━━━━━━━━┛  ┃ │ • 評論           │ ┃  ┃ │ • 合併策略       │ ┃
                        ┃ └─────────────────┘ ┃  ┃ └─────────────────┘ ┃
┏━━━━━━━━━━━━━━━━━━━━┓  ┃ ┌─────────────────┐ ┃  ┗━━━━━━━━━━━━━━━━━━━━┛
┃ 3. 時間軸服務        ┃  ┃ │ 結構化搜尋       │ ┃
┃ (Timeline Service)  ┃  ┃ │ • 建立者         │ ┃  ┏━━━━━━━━━━━━━━━━━━━━┓
┗━━━━━━━━━━━━━━━━━━━━┛  ┃ │ • 狀態           │ ┃  ┃ 11. 元數據系統       ┃
┃                     ┃  ┃ │ • 日期範圍       │ ┃  ┃ (Metadata System)   ┃
┃ 核心價值:            ┃  ┃ │ • 優先級         │ ┃  ┗━━━━━━━━━━━━━━━━━━━━┛
┃ 跨模組活動追蹤      ┃  ┃ │ • 標籤           │ ┃  ┃                     ┃
┃ 完整操作歷史        ┃  ┃ └─────────────────┘ ┃  ┃ 基本資訊:            ┃
┃                     ┃  ┃ ┌─────────────────┐ ┃  ┃ • 藍圖名稱          ┃
┃ 記錄範圍:            ┃  ┃ │ 關聯搜尋         │ ┃  ┃ • 藍圖描述          ┃
┃ ┌─────────────────┐ ┃  ┃ │ • 任務關聯日誌   │ ┃  ┃ • 封面圖片          ┃
┃ │ 系統層事件       │ ┃  ┃ │ • 任務關聯檔案   │ ┃  ┃ • 顏色主題          ┃
┃ │ • 藍圖建立       │ ┃  ┃ │ • 檔案關聯任務   │ ┃  ┃ • 圖示              ┃
┃ │ • 成員變更       │ ┃  ┃ └─────────────────┘ ┃  ┃                     ┃
┃ │ • 權限修改       │ ┃  ┃                     ┃  ┃ 分類系統:            ┃
┃ │ • 設定變更       │ ┃  ┃ 索引策略:            ┃  ┃ • 產業分類          ┃
┃ └─────────────────┘ ┃  ┃ • 即時索引          ┃  ┃ • 專案類型          ┃
┃ ┌─────────────────┐ ┃  ┃ • 增量更新          ┃  ┃ • 自訂分類          ┃
┃ │ 業務層事件       │ ┃  ┃ • 權重計算          ┃  ┃                     ┃
┃ │ • 任務建立       │ ┃  ┃ • 相關性排序        ┃  ┃ 自訂欄位:            ┃
┃ │ • 狀態變更       │ ┃  ┃                     ┃  ┃ • 文字欄位          ┃
┃ │ • 檔案上傳       │ ┃  ┃ 權限過濾:            ┃  ┃ • 數字欄位          ┃
┃ │ • 評論新增       │ ┃  ┃ • 只搜尋有權限資源  ┃  ┃ • 日期欄位          ┃
┃ │ • 日誌記錄       │ ┃  ┃ • 結果權限檢查      ┃  ┃ • 下拉選單          ┃
┃ └─────────────────┘ ┃  ┃ • 敏感資料遮罩      ┃  ┃ • 多選框            ┃
┃ ┌─────────────────┐ ┃  ┗━━━━━━━━━━━━━━━━━━━━┛  ┃ • 關聯欄位          ┃
┃ │ 用戶層事件       │ ┃                          ┃                     ┃
┃ │ • 登入登出       │ ┃  ┏━━━━━━━━━━━━━━━━━━━━┓  ┃ 版本控制:            ┃
┃ │ • 查看資源       │ ┃  ┃ 7. 關聯管理系統      ┃  ┃ • Schema版本        ┃
┃ │ • 匯出資料       │ ┃  ┃ (Relation Manager)  ┃  ┃ • 欄位變更歷史      ┃
┃ └─────────────────┘ ┃  ┗━━━━━━━━━━━━━━━━━━━━┛  ┃ • 遷移腳本          ┃
┃                     ┃  ┃                     ┃  ┗━━━━━━━━━━━━━━━━━━━━┛
┃ 時間軸視圖:          ┃  ┃ 核心功能:            ┃
┃ • 全局時間軸        ┃  ┃ 跨模組資源引用      ┃  ┏━━━━━━━━━━━━━━━━━━━━┓
┃ • 模組時間軸        ┃  ┃ 關聯完整性維護      ┃  ┃ 12. API閘道         ┃
┃ • 用戶時間軸        ┃  ┃                     ┃  ┃ (API Gateway)       ┃
┃ • 資源時間軸        ┃  ┃ 關聯類型:            ┃  ┗━━━━━━━━━━━━━━━━━━━━┛
┃                     ┃  ┃ ┌─────────────────┐ ┃  ┃                     ┃
┃ 版本控制:            ┃  ┃ │ 一對一 (1:1)     │ ┃  ┃ 核心功能:            ┃
┃ • 變更前快照        ┃  ┃ │ • 任務↔主負責人  │ ┃  ┃ 對外API統一入口     ┃
┃ • 變更後快照        ┃  ┃ └─────────────────┘ ┃  ┃ 第三方整合管理      ┃
┃ • Diff比對          ┃  ┃ ┌─────────────────┐ ┃  ┃                     ┃
┃ • 回溯還原          ┃  ┃ │ 一對多 (1:N)     │ ┃  ┃ API端點:            ┃
┃                     ┃  ┃ │ • 任務→子任務    │ ┃  ┃ ┌─────────────────┐ ┃
┃ 審計追蹤:            ┃  ┃ │ • 任務→檔案      │ ┃  ┃ │ REST API        │ ┃
┃ • 誰(Who)           ┃  ┃ │ • 日誌→附件      │ ┃  ┃ │ • /api/v1/*     │ ┃
┃ • 何時(When)        ┃  ┃ └─────────────────┘ ┃  ┃ │ • CRUD操作      │ ┃
┃ • 做什麼(What)      ┃  ┃ ┌─────────────────┐ ┃  ┃ │ • 批量操作      │ ┃
┃ • 為什麼(Why)       ┃  ┃ │ 多對多 (N:M)     │ ┃  ┃ │ • 分頁查詢      │ ┃
┃ • 在哪裡(Where)     ┃  ┃ │ • 任務↔標籤      │ ┃  ┃ └─────────────────┘ ┃
┃ • 如何做(How)       ┃  ┃ │ • 任務↔成員      │ ┃  ┃ ┌─────────────────┐ ┃
┗━━━━━━━━━━━━━━━━━━━━┛  ┃ │ • 藍圖↔協作者    │ ┃  ┃ │ GraphQL API     │ ┃
                        ┃ └─────────────────┘ ┃  ┃ │ • /graphql      │ ┃
┏━━━━━━━━━━━━━━━━━━━━┓  ┃ ┌─────────────────┐ ┃  ┃ │ • 靈活查詢      │ ┃
┃ 4. 通知中心          ┃  ┃ │ 階層關聯 (Tree)  │ ┃  ┃ │ • 減少請求      │ ┃
┃ (Notification Hub)  ┃  ┃ │ • 任務樹結構     │ ┃  ┃ │ • 型別安全      │ ┃
┗━━━━━━━━━━━━━━━━━━━━┛  ┃ │ • 組織架構       │ ┃  ┃ └─────────────────┘ ┃
┃                     ┃  ┃ └─────────────────┘ ┃  ┃ ┌─────────────────┐ ┃
┃ 核心價值:            ┃  ┃                     ┃  ┃ │ Webhook出站     │ ┃
┃ 統一通知管理        ┃  ┃ 完整性維護:          ┃  ┃ │ • 事件推送      │ ┃
┃ 多渠道路由          ┃  ┃ ┌─────────────────┐ ┃  ┃ │ • 重試機制      │ ┃
┃ 智能合併策略        ┃  ┃ │ CASCADE (級聯)   │ ┃  ┃ │ • 簽名驗證      │ ┃
┃                     ┃  ┃ │ • 刪除父資源     │ ┃  ┃ │ • 失敗通知      │ ┃
┃ 通知類型:            ┃  ┃ │ • 自動刪除子資源 │ ┃  ┃ └─────────────────┘ ┃
┃ ┌─────────────────┐ ┃  ┃ └─────────────────┘ ┃  ┃                     ┃
┃ │ 即時通知         │ ┃  ┃ ┌─────────────────┐ ┃  ┃ OAuth整合:          ┃
┃ │ • 任務指派       │ ┃  ┃ │ SET NULL (設空)  │ ┃  ┃ • Google           ┃
┃ │ • 提及(@)        │ ┃  ┃ │ • 刪除父資源     │ ┃  ┃ • Microsoft        ┃
┃ │ • 狀態變更       │ ┃  ┃ │ • 子資源解除關聯 │ ┃  ┃ • GitHub           ┃
┃ │ • 評論回覆       │ ┃  ┃ └─────────────────┘ ┃  ┃ • Slack            ┃
┃ └─────────────────┘ ┃  ┃ ┌─────────────────┐ ┃  ┃                     ┃
┃ ┌─────────────────┐ ┃  ┃ │ RESTRICT (限制)  │ ┃  ┃ 限流管理:            ┃
┃ │ 排程通知         │ ┃  ┃ │ • 有子資源時     │ ┃  ┃ • Rate Limiting    ┃
┃ │ • 截止日提醒     │ ┃  ┃ │ • 禁止刪除父資源 │ ┃  ┃ • 配額管理          ┃
┃ │ • 會議提醒       │ ┃  ┃ └─────────────────┘ ┃  ┃ • 防濫用機制        ┃
┃ │ • 定期報告       │ ┃  ┃                     ┃  ┃ • 降級策略          ┃
┃ └─────────────────┘ ┃  ┃ 關聯查詢優化:        ┃  ┃                     ┃
┃ ┌─────────────────┐ ┃  ┃ • 預載入 (Eager)    ┃  ┃ 安全機制:            ┃
┃ │ 摘要通知         │ ┃  ┃ • 懶載入 (Lazy)     ┃  ┃ • API Key          ┃
┃ │ • 日報           │ ┃  ┃ • 分頁載入          ┃  ┃ • JWT Token        ┃
┃ │ • 週報           │ ┃  ┃ • 快取策略          ┃  ┃ • IP白名單         ┃
┃ │ • 進度彙總       │ ┃  ┃                     ┃  ┃ • CORS設定         ┃
┃ └─────────────────┘ ┃  ┃ 循環引用偵測:        ┃  ┗━━━━━━━━━━━━━━━━━━━━┛
┃                     ┃  ┃ • 防止無限迴圈      ┃
┃ 通知渠道:            ┃  ┃ • 深度限制          ┃  ┏━━━━━━━━━━━━━━━━━━━━┓
┃ ┌─────────────────┐ ┃  ┃ • 警告提示          ┃  ┃ 8. 資料隔離系統      ┃
┃ │ App推播          │ ┃  ┗━━━━━━━━━━━━━━━━━━━━┛  ┃ (Data Isolation)    ┃
┃ │ • Firebase FCM   │ ┃                          ┗━━━━━━━━━━━━━━━━━━━━┛
┃ │ • 即時送達       │ ┃                          ┃                     ┃
┃ │ • Badge更新      │ ┃                          ┃ 核心價值:            ┃
┃ └─────────────────┘ ┃                          ┃ 多租戶資料安全      ┃
┃ ┌─────────────────┐ ┃                          ┃ 防止資料洩漏        ┃
┃ │ Email通知        │ ┃                          ┃                     ┃
┃ │ • 重要事項       │ ┃                          ┃ 隔離層級:            ┃
┃ │ • 摘要報告       │ ┃                          ┃ ┌─────────────────┐ ┃
┃ │ • 模板化內容     │ ┃                          ┃ │ 組織層隔離       │ ┃
┃ └─────────────────┘ ┃                          ┃ │ • 組織A的資料   │ ┃
┃ ┌─────────────────┐ ┃                          ┃ │ • 組織B看不到   │ ┃
┃ │ Webhook推送      │ ┃                          ┃ │ • 完全隔離      │ ┃
┃ │ • Slack         │ ┃                          ┃ └─────────────────┘ ┃
┃ │ • Teams         │ ┃                          ┃ ┌─────────────────┐ ┃
┃ │ • Discord       │ ┃                          ┃ │ 藍圖層隔離       │ ┃
┃ │ • 自訂端點       │ ┃                          ┃ │ • 藍圖A的資料   │ ┃
┃ └─────────────────┘ ┃                          ┃ │ • 藍圖B看不到   │ ┃
┃                     ┃                          ┃ │ • 同組織也隔離  │ ┃
┃ 訂閱管理:            ┃                          ┃ └─────────────────┘ ┃
┃ • 用戶自訂訂閱      ┃                          ┃ ┌─────────────────┐ ┃
┃ • 按類型訂閱        ┃                          ┃ │ 成員層隔離       │ ┃
┃ • 按資源訂閱        ┃                          ┃ │ • 成員權限檢查  │ ┃
┃ • 按標籤訂閱        ┃                          ┃ │ • 非成員無法訪問│ ┃
┃                     ┃                          ┃ │ • 資源級權限    │ ┃
┃ 智能合併:            ┃                          ┃ └─────────────────┘ ┃
┃ • 相同類型合併      ┃                          ┃                     ┃
┃ • 時間窗口合併      ┃                          ┃ 技術實現:            ┃
┃ • 防止轟炸用戶      ┃                          ┃ ┌─────────────────┐ ┃
┃ • 優先級排序        ┃                          ┃ │ Row Level        │ ┃
┃                     ┃                          ┃ │ Security (RLS)   │ ┃
┃ 勿擾模式:            ┃                          ┃ │ • Supabase原生  │ ┃
┃ • 時段設定          ┃                          ┃ │ • 資料庫層隔離  │ ┃
┃ • 緊急通知例外      ┃                          ┃ │ • 自動檢查      │ ┃
┃ • 假日模式          ┃                          ┃ └─────────────────┘ ┃
┗━━━━━━━━━━━━━━━━━━━━┛                          ┃ ┌─────────────────┐ ┃
                                                ┃ │ Query Filter     │ ┃
                                                ┃ │ • WHERE條件     │ ┃
                                                ┃ │ • JOIN限制      │ ┃
                                                ┃ │ • 子查詢過濾    │ ┃
                                                ┃ └─────────────────┘ ┃
                                                ┃                     ┃
                                                ┃ 配額管理:            ┃
                                                ┃ • 儲存空間限制      ┃
                                                ┃ • 成員數量限制      ┃
                                                ┃ • API調用限制       ┃
                                                ┃ • 藍圖數量限制      ┃
                                                ┃                     ┃
                                                ┃ 邊界控制:            ┃
                                                ┃ • 成員名單驗證      ┃
                                                ┃ • 資源歸屬驗證      ┃
                                                ┃ • 跨藍圖訪問阻斷    ┃
                                                ┃ • 敏感資料遮罩      ┃
                                                ┗━━━━━━━━━━━━━━━━━━━━┛

═══════════════════════════════════════════════════════════════════════════════
                     【業務模組層 - BUSINESS MODULE LAYER】
                          繼承容器層的所有基礎設施
═══════════════════════════════════════════════════════════════════════════════

        ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
        ┃          模組基礎設施 (每個業務模組都必須實作)               ┃
        ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                                       │
        ┌──────────────────────────────┼──────────────────────────────┐
        ↓                              ↓                              ↓

┏━━━━━━━━━━━━━━━━━━━━┓  ┏━━━━━━━━━━━━━━━━━━━━┓  ┏━━━━━━━━━━━━━━━━━━━━┓
┃ 1. 生命週期鉤子      ┃  ┃ 4. 事件介面          ┃  ┃ 7. 擴展點系統        ┃
┃ (Lifecycle Hooks)   ┃  ┃ (Event Interface)   ┃  ┃ (Extension Points)  ┃
┗━━━━━━━━━━━━━━━━━━━━┛  ┗━━━━━━━━━━━━━━━━━━━━┛  ┗━━━━━━━━━━━━━━━━━━━━┛
┃                     ┃  ┃                     ┃  ┃                     ┃
┃ 標準化介面:          ┃  ┃ 發布事件:            ┃  ┃ 自訂欄位:            ┃
┃ ┌─────────────────┐ ┃  ┃ • publish()         ┃  ┃ • 文字               ┃
┃ │ onModuleInit()  │ ┃  ┃ • 定義事件類型      ┃  ┃ • 數字               ┃
┃ │ • 模組初始化     │ ┃  ┃ • 設定事件數據      ┃  ┃ • 日期               ┃
┃ │ • 載入設定       │ ┃  ┃ • 非同步發布        ┃  ┃ • 下拉選單           ┃
┃ │ • 註冊服務       │ ┃  ┃                     ┃  ┃ • 關聯欄位           ┃
┃ └─────────────────┘ ┃  ┃ 訂閱事件:            ┃  ┃                     ┃
┃ ┌─────────────────┐ ┃  ┃ • subscribe()       ┃  ┃ 自訂操作:            ┃
┃ │ onContextChange()│ ┃  ┃ • 訂閱特定類型      ┃  ┃ • 工作流程觸發器    ┃
┃ │ • 藍圖切換       │ ┃  ┃ • 設定過濾條件      ┃  ┃ • 自動化規則        ┃
┃ │ • 重新載入資料   │ ┃  ┃ • 處理回調函數      ┃  ┃ • 狀態機定義        ┃
┃ │ • 更新UI狀態     │ ┃  ┃                     ┃  ┃                     ┃
┃ └─────────────────┘ ┃  ┃ 事件過濾:            ┃  ┃ 驗證規則:            ┃
┃ ┌─────────────────┐ ┃  ┃ • 按類型過濾        ┃  ┃ • 必填欄位          ┃
┃ │ onPermissionChange()│ ┃ • 按資源過濾        ┃  ┃ • 格式驗證          ┃
┃ │ • 權限變更       │ ┃  ┃ • 按用戶過濾        ┃  ┃ • 自訂邏輯          ┃
┃ │ • UI權限更新     │ ┃  ┃ • 條件訂閱          ┃  ┃ • 跨欄位驗證        ┃
┃ │ • 功能啟用/停用  │ ┃  ┃                     ┃  ┃                     ┃
┃ └─────────────────┘ ┃  ┃ 事件範例:            ┃  ┃ UI擴展點:            ┃
┃ ┌─────────────────┐ ┃  ┃ ┌─────────────────┐ ┃  ┃ • 自訂按鈕          ┃
┃ │ onModuleDestroy()│ ┃  ┃ │ task.created    │ ┃  ┃ • 自訂面板          ┃
┃ │ • 清理資源       │ ┃  ┃ │ task.updated    │ ┃  ┃ • 自訂視圖          ┃
┃ │ • 取消訂閱       │ ┃  ┃ │ task.deleted    │ ┃  ┃ • 快捷操作          ┃
┃ │ • 保存狀態       │ ┃  ┃ │ task.assigned   │ ┃  ┗━━━━━━━━━━━━━━━━━━━━┛
┃ └─────────────────┘ ┃  ┃ │ task.completed  │ ┃
┗━━━━━━━━━━━━━━━━━━━━┛  ┃ └─────────────────┘ ┃  ┏━━━━━━━━━━━━━━━━━━━━┓
                        ┗━━━━━━━━━━━━━━━━━━━━┛  ┃ 8. 匯入匯出          ┃
┏━━━━━━━━━━━━━━━━━━━━┓                          ┃ (Import/Export)     ┃
┃ 2. 資料操作層        ┃  ┏━━━━━━━━━━━━━━━━━━━━┓  ┗━━━━━━━━━━━━━━━━━━━━┛
┃ (Data Access Layer) ┃  ┃ 5. 搜尋註冊          ┃  ┃                     ┃
┗━━━━━━━━━━━━━━━━━━━━┛  ┃ (Search Registry)   ┃  ┃ 批量操作:            ┃
┃                     ┃  ┗━━━━━━━━━━━━━━━━━━━━┛  ┃ • 批量建立          ┃
┃ CRUD介面:           ┃  ┃                     ┃  ┃ • 批量更新          ┃
┃ • create()          ┃  ┃ 可搜尋欄位定義:      ┃  ┃ • 批量刪除          ┃
┃ • read()            ┃  ┃ ┌─────────────────┐ ┃  ┃ • 批量指派          ┃
┃ • update()          ┃  ┃ │ 任務模組         │ ┃  ┃                     ┃
┃ • delete()          ┃  ┃ │ • title (權重9)  │ ┃  ┃ 匯入格式:            ┃
┃ • list()            ┃  ┃ │ • description(5)│ ┃  ┃ • CSV               ┃
┃ • search()          ┃  ┃ │ • tags (3)      │ ┃  ┃ • Excel             ┃
┃                     ┃  ┃ │ • assignee (7)  │ ┃  ┃ • JSON              ┃
┃ 樂觀鎖:              ┃  ┃ └─────────────────┘ ┃  ┃ • XML               ┃
┃ • version欄位       ┃  ┃ ┌─────────────────┐ ┃  ┃                     ┃
┃ • 並發衝突偵測      ┃  ┃ │ 日誌模組         │ ┃  ┃ 匯出格式:            ┃
┃ • 重試機制          ┃  ┃ │ • title (9)     │ ┃  ┃ • CSV               ┃
┃                     ┃  ┃ │ • content (8)   │ ┃  ┃ • Excel             ┃
┃ 軟刪除:              ┃  ┃ │ • tags (3)      │ ┃  ┃ • PDF               ┃
┃ • deleted_at欄位    ┃  ┃ └─────────────────┘ ┃  ┃ • JSON              ┃
┃ • 可恢復            ┃  ┃                     ┃  ┃                     ┃
┃ • 定期清理          ┃  ┃ 索引設定:            ┃  ┃ 資料驗證:            ┃
┃                     ┃  ┃ • 全文索引          ┃  ┃ • 格式檢查          ┃
┃ 版本控制:            ┃  ┃ • 複合索引          ┃  ┃ • 必填欄位          ┃
┃ • 自動版本號        ┃  ┃ • 權重計算          ┃  ┃ • 重複檢查          ┃
┃ • 變更歷史          ┃  ┃ • 同義詞設定        ┃  ┃ • 關聯驗證          ┃
┃ • Diff比對          ┃  ┃                     ┃  ┃                     ┃
┗━━━━━━━━━━━━━━━━━━━━┛  ┃ 搜尋優化:            ┃  ┃ 錯誤處理:            ┃
                        ┃ • 分詞設定          ┃  ┃ • 詳細錯誤報告      ┃
┏━━━━━━━━━━━━━━━━━━━━┓  ┃ • 忽略詞設定        ┃  ┃ • 部分成功處理      ┃
┃ 3. 權限檢查點        ┃  ┃ • 高亮顯示          ┃  ┃ • 回滾機制          ┃
┃ (Permission Gates)  ┃  ┗━━━━━━━━━━━━━━━━━━━━┛  ┗━━━━━━━━━━━━━━━━━━━━┛
┗━━━━━━━━━━━━━━━━━━━━┛
┃                     ┃  ┏━━━━━━━━━━━━━━━━━━━━┓
┃ 操作權限:            ┃  ┃ 6. 視圖框架          ┃
┃ • task.create       ┃  ┃ (View Framework)    ┃
┃ • task.read         ┃  ┗━━━━━━━━━━━━━━━━━━━━┛
┃ • task.update       ┃  ┃                     ┃
┃ • task.delete       ┃  ┃ 預設視圖:            ┃
┃ • task.assign       ┃  ┃ • 列表視圖          ┃
┃                     ┃  ┃ • 看板視圖          ┃
┃ 資源權限:            ┃  ┃ • 日曆視圖          ┃
┃ • 創建者檢查        ┃  ┃ • 甘特圖視圖        ┃
┃ • 指派者檢查        ┃  ┃ • 時間軸視圖        ┃
┃ • 團隊成員檢查      ┃  ┃                     ┃
┃                     ┃  ┃ 個人化視圖:          ┃
┃ 欄位權限:            ┃  ┃ • 自訂篩選器        ┃
┃ • 敏感欄位遮罩      ┃  ┃ • 自訂排序          ┃
┃ • 唯讀欄位          ┃  ┃ • 自訂分組          ┃
┃ • 條件顯示          ┃  ┃ • 欄位顯示/隱藏     ┃
┗━━━━━━━━━━━━━━━━━━━━┛  ┃ • 保存視圖設定      ┃
                        ┃                     ┃
                        ┃ 共享視圖:            ┃
                        ┃ • 團隊共享          ┃
                        ┃ • 公開連結          ┃
                        ┃ • 權限控制          ┃
                        ┃ • 版本管理          ┃
                        ┗━━━━━━━━━━━━━━━━━━━━┛

═══════════════════════════════════════════════════════════════════════════════
                     【六大核心業務模組 - CORE BUSINESS MODULES】
                          基於容器層構建的垂直業務能力
═══════════════════════════════════════════════════════════════════════════════

        ┌──────────────────────────────────────────────────────────────────┐
        │                    業務模組總覽                                   │
        ├──────────────────────────────────────────────────────────────────┤
        │                                                                  │
        │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
        │  │ 📋 任務模組  │  │ 📝 日誌模組  │  │ ✅ 待辦模組  │              │
        │  │   (Tasks)   │  │   (Logs)    │  │  (Todos)    │              │
        │  │             │  │             │  │             │              │
        │  │ 協作執行    │  │ 工作記錄    │  │ 個人清單    │              │
        │  │ 狀態追蹤    │  │ 時間追溯    │  │ 快速行動    │              │
        │  │ 多維度視圖  │  │ 知識沉澱    │  │ 輕量管理    │              │
        │  └─────────────┘  └─────────────┘  └─────────────┘              │
        │                                                                  │
        │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
        │  │ 📁 檔案模組  │  │ 🔗 連結模組  │  │ 📊 儀表板    │              │
        │  │   (Files)   │  │  (Links)    │  │ (Dashboard) │              │
        │  │             │  │             │  │             │              │
        │  │ 資源管理    │  │ 外部整合    │  │ 數據洞察    │              │
        │  │ 版本控制    │  │ 快速導航    │  │ 視覺化報表  │              │
        │  │ 權限控制    │  │ 書籤收藏    │  │ 即時監控    │              │
        │  └─────────────┘  └─────────────┘  └─────────────┘              │
        │                                                                  │
        └──────────────────────────────────────────────────────────────────┘

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                         模組 1: 任務管理 (Tasks)                          ┃
┃                           「協作的核心引擎」                              ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┌────────────────────────────────────────────────────────────────────────────┐
│                               任務資料模型                                 │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  基本資訊                     排程資訊                     關聯資訊        │
│  ───────────                 ───────────                 ───────────      │
│  • task_id (UUID)            • start_date               • parent_task_id  │
│  • title (標題)               • due_date                 • related_tasks   │
│  • description (描述)         • estimated_hours          • linked_logs     │
│  • status (狀態)              • actual_hours             • attached_files  │
│  • priority (優先級)          • time_tracking            • related_links   │
│  • progress (進度 %)                                                       │
│                                                                            │
│  人員資訊                     組織資訊                     系統資訊        │
│  ───────────                 ───────────                 ───────────      │
│  • creator_id                • blueprint_id             • created_at      │
│  • assignee_id               • team_id (可選)            • updated_at      │
│  • assignees[] (多人)        • watchers[]               • deleted_at      │
│  • reviewer_id                                          • version         │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│                               任務狀態機                                   │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│     ┌──────────┐     開始      ┌──────────┐     提交      ┌──────────┐   │
│     │ Pending  │ ──────────→ │ Progress │ ──────────→ │ Review   │   │
│     │ (待處理)  │             │ (進行中)  │             │ (審核中)  │   │
│     └──────────┘             └──────────┘             └──────────┘   │
│          │                        │                        │            │
│          │                        │ 阻塞                    │            │
│          │                        ↓                        │ 通過       │
│          │                   ┌──────────┐                  ↓            │
│          │                   │ Blocked  │            ┌──────────┐      │
│          │                   │ (已阻塞)  │            │ Completed│      │
│          │                   └──────────┘            │ (已完成)  │      │
│          │                        │                  └──────────┘      │
│          │                        │ 解除阻塞                            │
│          │                        └────────→ (返回 Progress)           │
│          │                                                              │
│          │ 取消                                        ↑ 退回           │
│          └──────────────────────────────────────────────┘               │
│                                     ↓                                   │
│                              ┌──────────┐                               │
│                              │ Cancelled│                               │
│                              │ (已取消)  │                               │
│                              └──────────┘                               │
│                                                                         │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│                               任務視圖模式                                 │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐│
│  │ 📋 列表視圖          │  │ 📊 看板視圖          │  │ 📅 日曆視圖          ││
│  │                     │  │                     │  │                     ││
│  │ • 表格形式展示       │  │ • Kanban拖拽        │  │ • 日/週/月視圖      ││
│  │ • 快速篩選排序       │  │ • 狀態泳道          │  │ • 截止日標記        ││
│  │ • 批量操作          │  │ • WIP限制           │  │ • 時間軸顯示        ││
│  │ • 欄位自訂          │  │ • 進度視覺化        │  │ • 拖拽調整          ││
│  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘│
│                                                                            │
│  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐│
│  │ 📈 甘特圖視圖        │  │ 🕐 時間軸視圖        │  │ 🔲 矩陣視圖          ││
│  │                     │  │                     │  │                     ││
│  │ • 專案排程          │  │ • 活動記錄          │  │ • 優先級/狀態       ││
│  │ • 依賴關係          │  │ • 變更歷史          │  │ • 熱力圖            ││
│  │ • 進度追蹤          │  │ • 里程碑標記        │  │ • 焦點區域          ││
│  │ • 資源配置          │  │ • 時間分析          │  │ • 風險評估          ││
│  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘│
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                         模組 2: 工作日誌 (Logs)                           ┃
┃                          「知識沉澱的載體」                               ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┌────────────────────────────────────────────────────────────────────────────┐
│                               日誌資料模型                                 │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  基本資訊                     內容資訊                     關聯資訊        │
│  ───────────                 ───────────                 ───────────      │
│  • log_id (UUID)             • content (富文本)          • linked_tasks    │
│  • title (標題)               • content_type             • attached_files  │
│  • log_type (類型)            • word_count               • mentioned_users │
│  • visibility (可見性)        • reading_time             • related_logs    │
│                                                                            │
│  時間資訊                     人員資訊                     系統資訊        │
│  ───────────                 ───────────                 ───────────      │
│  • log_date (日誌日期)        • author_id                • created_at      │
│  • work_hours (工時)          • collaborators[]          • updated_at      │
│  • time_range (時段)          • reviewers[]              • version         │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│                               日誌類型體系                                 │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │
│  │ 📝 工作日誌      │  │ 🐛 問題記錄      │  │ 💡 決策記錄      │            │
│  │                 │  │                 │  │                 │            │
│  │ • 每日進展      │  │ • Bug紀錄       │  │ • 技術決策      │            │
│  │ • 工時統計      │  │ • 解決方案      │  │ • 架構選擇      │            │
│  │ • 心得體會      │  │ • 根因分析      │  │ • 方案對比      │            │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘            │
│                                                                            │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │
│  │ 🎯 會議記錄      │  │ 📚 學習筆記      │  │ 🔬 實驗記錄      │            │
│  │                 │  │                 │  │                 │            │
│  │ • 會議摘要      │  │ • 技術學習      │  │ • 測試結果      │            │
│  │ • 決議事項      │  │ • 心得分享      │  │ • 數據分析      │            │
│  │ • 行動項目      │  │ • 資源連結      │  │ • 結論建議      │            │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘            │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                         模組 3: 待辦事項 (Todos)                          ┃
┃                          「輕量級行動管理」                               ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┌────────────────────────────────────────────────────────────────────────────┐
│                               待辦資料模型                                 │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  基本資訊                     狀態資訊                     關聯資訊        │
│  ───────────                 ───────────                 ───────────      │
│  • todo_id (UUID)            • is_completed              • linked_task     │
│  • title (標題)               • completed_at             • parent_todo     │
│  • notes (備註)               • is_starred (星標)        • sub_todos[]     │
│  • due_date (截止日)          • reminder                 • attached_files  │
│  • priority                  • repeat_rule              • tags[]          │
│                                                                            │
│  歸屬資訊                     系統資訊                                     │
│  ───────────                 ───────────                                   │
│  • owner_id                  • created_at                                 │
│  • list_id (清單)             • updated_at                                 │
│  • blueprint_id              • sort_order                                 │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│                         任務 vs 待辦 的定位差異                            │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  ┌───────────────────────────┐  ┌───────────────────────────┐            │
│  │      📋 任務 (Task)        │  │      ✅ 待辦 (Todo)        │            │
│  ├───────────────────────────┤  ├───────────────────────────┤            │
│  │ • 團隊協作導向            │  │ • 個人行動導向            │            │
│  │ • 豐富的狀態流轉          │  │ • 簡單的完成/未完成       │            │
│  │ • 多人指派與審核          │  │ • 個人負責執行            │            │
│  │ • 詳細的進度追蹤          │  │ • 快速建立與勾選          │            │
│  │ • 複雜的關聯體系          │  │ • 輕量的組織結構          │            │
│  │ • 完整的時間記錄          │  │ • 提醒與重複功能          │            │
│  └───────────────────────────┘  └───────────────────────────┘            │
│                                                                            │
│  ═══════════════════════════════════════════════════════════════          │
│                                                                            │
│  關聯機制:                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐          │
│  │                                                             │          │
│  │   Task ←────────────────→ Todo                             │          │
│  │         (可互相關聯)                                        │          │
│  │                                                             │          │
│  │   • 任務可分解為多個待辦                                     │          │
│  │   • 待辦可升級為任務                                         │          │
│  │   • 完成待辦可更新任務進度                                   │          │
│  │                                                             │          │
│  └─────────────────────────────────────────────────────────────┘          │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                         模組 4: 檔案管理 (Files)                          ┃
┃                          「數位資產的保險箱」                             ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┌────────────────────────────────────────────────────────────────────────────┐
│                               檔案資料模型                                 │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  基本資訊                     檔案資訊                     關聯資訊        │
│  ───────────                 ───────────                 ───────────      │
│  • file_id (UUID)            • mime_type                • linked_tasks    │
│  • name (檔名)                • size (大小)              • linked_logs     │
│  • description               • storage_path             • folder_id       │
│  • file_type (類型)           • thumbnail_url           • tags[]          │
│                                                                            │
│  版本資訊                     權限資訊                     系統資訊        │
│  ───────────                 ───────────                 ───────────      │
│  • version_number            • visibility               • created_at      │
│  • version_history[]         • access_level             • updated_at      │
│  • is_latest                 • shared_with[]            • uploader_id     │
│  • parent_version_id         • download_count           • checksum        │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│                               檔案組織結構                                 │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  藍圖根目錄                                                                │
│  └── 📁 資料夾結構                                                        │
│       ├── 📁 專案文件                                                     │
│       │    ├── 📄 需求文檔.docx                                           │
│       │    ├── 📄 設計規格.pdf                                            │
│       │    └── 📁 版本歷史                                                │
│       ├── 📁 設計資源                                                     │
│       │    ├── 🖼️ UI設計稿.fig                                           │
│       │    └── 🖼️ 圖標資源.svg                                           │
│       ├── 📁 會議記錄                                                     │
│       │    ├── 📄 週會記錄_0301.md                                        │
│       │    └── 🎬 會議錄影_0301.mp4                                       │
│       └── 📁 交付成果                                                     │
│            ├── 📦 Release_v1.0.zip                                        │
│            └── 📄 驗收報告.pdf                                            │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                         模組 5: 連結管理 (Links)                          ┃
┃                          「外部世界的入口」                               ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┌────────────────────────────────────────────────────────────────────────────┐
│                               連結資料模型                                 │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  基本資訊                     連結資訊                     關聯資訊        │
│  ───────────                 ───────────                 ───────────      │
│  • link_id (UUID)            • url (網址)               • linked_tasks    │
│  • title (標題)               • favicon_url             • linked_logs     │
│  • description               • preview_image           • category_id     │
│  • link_type (類型)           • is_valid                • tags[]          │
│                                                                            │
│  使用資訊                     系統資訊                                     │
│  ───────────                 ───────────                                   │
│  • visit_count               • created_at                                 │
│  • last_visited_at           • updated_at                                 │
│  • is_starred                • creator_id                                 │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│                               連結類型分類                                 │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │
│  │ 🔗 參考資源      │  │ 🛠️ 工具連結      │  │ 📖 文檔連結      │            │
│  │                 │  │                 │  │                 │            │
│  │ • 技術文章      │  │ • 開發工具      │  │ • API文檔       │            │
│  │ • 教程指南      │  │ • 線上服務      │  │ • 使用手冊      │            │
│  │ • 規範標準      │  │ • 協作平台      │  │ • Wiki頁面      │            │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘            │
│                                                                            │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │
│  │ 🔌 整合連結      │  │ 📊 數據來源      │  │ ⭐ 書籤收藏      │            │
│  │                 │  │                 │  │                 │            │
│  │ • GitHub Repo   │  │ • 分析平台      │  │ • 常用網站      │            │
│  │ • Jira Issue    │  │ • 監控看板      │  │ • 重要連結      │            │
│  │ • Figma設計     │  │ • 數據報表      │  │ • 快速訪問      │            │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘            │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                         模組 6: 儀表板 (Dashboard)                        ┃
┃                          「決策的數據支援」                               ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┌────────────────────────────────────────────────────────────────────────────┐
│                               儀表板組件庫                                 │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ 📊 任務統計卡                                                        │  │
│  │                                                                      │  │
│  │   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐              │  │
│  │   │   12    │  │    8    │  │    3    │  │    1    │              │  │
│  │   │ 總任務   │  │ 進行中   │  │ 已完成   │  │ 已逾期   │              │  │
│  │   └─────────┘  └─────────┘  └─────────┘  └─────────┘              │  │
│  │                                                                      │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                                                            │
│  ┌────────────────────────────┐  ┌────────────────────────────┐          │
│  │ 📈 進度趨勢圖              │  │ 🥧 任務分佈圖              │          │
│  │                            │  │                            │          │
│  │   100%│         ╭─────    │  │      ┌─────┐              │          │
│  │    75%│     ╭───╯         │  │     ╱ 待處理 ╲             │          │
│  │    50%│ ╭───╯             │  │    ╱   30%   ╲            │          │
│  │    25%│╯                  │  │   │  進行中   │           │          │
│  │     0%└───────────────    │  │    ╲   45%   ╱            │          │
│  │       W1  W2  W3  W4      │  │     ╲ 已完成 ╱ 25%        │          │
│  │                            │  │      └─────┘              │          │
│  └────────────────────────────┘  └────────────────────────────┘          │
│                                                                            │
│  ┌────────────────────────────┐  ┌────────────────────────────┐          │
│  │ 👥 成員工作量              │  │ 📅 即將到期任務            │          │
│  │                            │  │                            │          │
│  │  Alice ████████████ 12    │  │  • [P0] 緊急任務 (今天)    │          │
│  │  Bob   ████████░░░░  8    │  │  • [P1] 重要功能 (明天)    │          │
│  │  Carol ████████████ 10    │  │  • [P2] 優化項目 (本週)    │          │
│  │  David ████░░░░░░░░  4    │  │  • [P2] 文檔更新 (下週)    │          │
│  │                            │  │                            │          │
│  └────────────────────────────┘  └────────────────────────────┘          │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│                               儀表板自訂化                                 │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  布局設計:                    數據來源:                    更新策略:       │
│  ───────────                 ───────────                 ───────────      │
│  • 網格系統                  • 跨模組聚合                • 即時更新        │
│  • 拖拽排版                  • 時間範圍選擇              • 定時刷新        │
│  • 響應式設計                • 篩選條件設定              • 手動刷新        │
│  • 多頁面支援                • 計算欄位                  • 快取策略        │
│                                                                            │
│  分享功能:                    導出功能:                                    │
│  ───────────                 ───────────                                   │
│  • 團隊內共享                • PDF報表                                    │
│  • 公開連結                  • Excel數據                                  │
│  • 嵌入式iframe             • 圖片快照                                    │
│  • 定時報告發送              • 數據API                                    │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
                           【跨模組關聯矩陣】
                         模組之間的關聯與互動
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                            關聯關係矩陣                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│              │ Tasks │ Logs  │ Todos │ Files │ Links │ Dashboard │         │
│  ────────────┼───────┼───────┼───────┼───────┼───────┼───────────┤         │
│  Tasks       │   -   │  N:M  │  1:N  │  N:M  │  N:M  │   聚合    │         │
│  ────────────┼───────┼───────┼───────┼───────┼───────┼───────────┤         │
│  Logs        │  N:M  │   -   │   -   │  N:M  │  N:M  │   聚合    │         │
│  ────────────┼───────┼───────┼───────┼───────┼───────┼───────────┤         │
│  Todos       │  1:N  │   -   │  Tree │  N:M  │   -   │   聚合    │         │
│  ────────────┼───────┼───────┼───────┼───────┼───────┼───────────┤         │
│  Files       │  N:M  │  N:M  │  N:M  │ Tree  │   -   │   聚合    │         │
│  ────────────┼───────┼───────┼───────┼───────┼───────┼───────────┤         │
│  Links       │  N:M  │  N:M  │   -   │   -   │ Tree  │   聚合    │         │
│  ────────────┼───────┼───────┼───────┼───────┼───────┼───────────┤         │
│  Dashboard   │ 聚合  │ 聚合  │ 聚合  │ 聚合  │ 聚合  │     -     │         │
│                                                                             │
│  說明:                                                                      │
│  • N:M = 多對多關聯 (透過關聯表)                                            │
│  • 1:N = 一對多關聯 (外鍵關係)                                              │
│  • Tree = 樹狀結構 (自引用)                                                 │
│  • 聚合 = 只讀取，不建立關聯                                                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
                              【設計總結】
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                            架構設計原則                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  🏗️ 分層架構:                                                              │
│  ──────────                                                                 │
│  1. 基礎層 (Foundation) - 帳戶體系、身份認證、訂閱計費                      │
│  2. 容器層 (Container) - 藍圖系統、權限控制、基礎設施                       │
│  3. 業務層 (Business) - 六大核心業務模組                                    │
│                                                                             │
│  🔐 安全設計:                                                               │
│  ──────────                                                                 │
│  • Row Level Security (RLS) - 資料庫層的資料隔離                            │
│  • RBAC 權限模型 - 多層級角色繼承                                           │
│  • JWT/OAuth 認證 - 安全的身份驗證                                          │
│  • API Rate Limiting - 防止濫用                                             │
│                                                                             │
│  🚀 擴展性設計:                                                             │
│  ──────────                                                                 │
│  • 模組化架構 - 獨立開發、獨立部署                                          │
│  • 事件驅動 - 模組間鬆耦合                                                  │
│  • 插件系統 - 自訂欄位、自訂視圖、自訂工作流                                │
│  • API優先 - 支援第三方整合                                                 │
│                                                                             │
│  📊 效能優化:                                                               │
│  ──────────                                                                 │
│  • 多層快取策略 - 減少資料庫查詢                                            │
│  • 樂觀鎖機制 - 處理並發更新                                                │
│  • 索引優化 - 加速搜尋查詢                                                  │
│  • 懶載入 - 按需載入資料                                                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                            技術選型建議                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  前端技術:                    後端服務:                    基礎設施:        │
│  ───────────                 ───────────                 ───────────       │
│  • Angular 20               • Supabase                  • Supabase Auth    │
│  • ng-alain                 • PostgreSQL                • Supabase Storage │
│  • ng-zorro-antd            • Edge Functions            • Supabase Realtime│
│  • RxJS                     • PostgREST API             • CDN              │
│  • TypeScript               • Row Level Security        • CI/CD Pipeline   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```