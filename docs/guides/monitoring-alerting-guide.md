# ç›£æ§èˆ‡å‘Šè­¦é…ç½®æŒ‡å—


> **ğŸ“š ç›®çš„**: å»ºç«‹å®Œæ•´çš„ç›£æ§èˆ‡å‘Šè­¦ç³»çµ±ï¼ŒåŠæ™‚ç™¼ç¾ä¸¦è™•ç†ç³»çµ±å•é¡Œ

## ç›®æ¨™è®€è€… (Audience)

- DevOps å·¥ç¨‹å¸«
- ç³»çµ±ç®¡ç†å“¡
- å¾Œç«¯é–‹ç™¼è€…

---


## ğŸ“‘ ç›®éŒ„

- [ğŸ“‹ ç›®éŒ„](#-ç›®éŒ„)
- [ç›£æ§æ¶æ§‹](#ç›£æ§æ¶æ§‹)
  - [ç›£æ§å±¤ç´š](#ç›£æ§å±¤ç´š)
  - [ç›£æ§å·¥å…·æ•´åˆ](#ç›£æ§å·¥å…·æ•´åˆ)
- [ç›£æ§æŒ‡æ¨™å®šç¾©](#ç›£æ§æŒ‡æ¨™å®šç¾©)
  - [1. å‰ç«¯æ•ˆèƒ½æŒ‡æ¨™](#1-å‰ç«¯æ•ˆèƒ½æŒ‡æ¨™)
    - [Core Web Vitals](#core-web-vitals)
    - [JavaScript éŒ¯èª¤ç‡](#javascript-éŒ¯èª¤ç‡)
  - [2. API æ•ˆèƒ½æŒ‡æ¨™](#2-api-æ•ˆèƒ½æŒ‡æ¨™)
    - [API å›æ‡‰æ™‚é–“](#api-å›æ‡‰æ™‚é–“)
    - [API éŒ¯èª¤ç‡](#api-éŒ¯èª¤ç‡)
    - [RPC å‡½æ•¸åŸ·è¡Œ](#rpc-å‡½æ•¸åŸ·è¡Œ)
  - [3. è³‡æ–™åº«æŒ‡æ¨™](#3-è³‡æ–™åº«æŒ‡æ¨™)
    - [é€£ç·šæ± ä½¿ç”¨ç‡](#é€£ç·šæ± ä½¿ç”¨ç‡)
    - [æŸ¥è©¢æ•ˆèƒ½](#æŸ¥è©¢æ•ˆèƒ½)
    - [å„²å­˜ç©ºé–“](#å„²å­˜ç©ºé–“)
  - [4. æ¥­å‹™æŒ‡æ¨™](#4-æ¥­å‹™æŒ‡æ¨™)
    - [ä½¿ç”¨è€…æ´»å‹•](#ä½¿ç”¨è€…æ´»å‹•)
    - [ç³»çµ±å¯ç”¨æ€§](#ç³»çµ±å¯ç”¨æ€§)
- [å‘Šè­¦è¦å‰‡é…ç½®](#å‘Šè­¦è¦å‰‡é…ç½®)
  - [å‘Šè­¦ç­‰ç´šå®šç¾©](#å‘Šè­¦ç­‰ç´šå®šç¾©)
  - [å‘Šè­¦è¦å‰‡ç¯„ä¾‹](#å‘Šè­¦è¦å‰‡ç¯„ä¾‹)
    - [1. å‰ç«¯å‘Šè­¦](#1-å‰ç«¯å‘Šè­¦)
    - [2. API å‘Šè­¦](#2-api-å‘Šè­¦)
    - [3. è³‡æ–™åº«å‘Šè­¦](#3-è³‡æ–™åº«å‘Šè­¦)
    - [4. æ¥­å‹™å‘Šè­¦](#4-æ¥­å‹™å‘Šè­¦)
  - [å‘Šè­¦æŠ‘åˆ¶è¦å‰‡](#å‘Šè­¦æŠ‘åˆ¶è¦å‰‡)
- [æ—¥èªŒç®¡ç†è¦ç¯„](#æ—¥èªŒç®¡ç†è¦ç¯„)
  - [æ—¥èªŒç­‰ç´š](#æ—¥èªŒç­‰ç´š)
  - [æ—¥èªŒæ ¼å¼](#æ—¥èªŒæ ¼å¼)
  - [æ—¥èªŒè¨˜éŒ„æœ€ä½³å¯¦è¸](#æ—¥èªŒè¨˜éŒ„æœ€ä½³å¯¦è¸)
  - [æ—¥èªŒä¿ç•™ç­–ç•¥](#æ—¥èªŒä¿ç•™ç­–ç•¥)
- [å„€è¡¨æ¿é…ç½®](#å„€è¡¨æ¿é…ç½®)
  - [1. å³æ™‚ç›£æ§å„€è¡¨æ¿](#1-å³æ™‚ç›£æ§å„€è¡¨æ¿)
  - [2. æ•ˆèƒ½åˆ†æå„€è¡¨æ¿](#2-æ•ˆèƒ½åˆ†æå„€è¡¨æ¿)
  - [3. æ¥­å‹™æŒ‡æ¨™å„€è¡¨æ¿](#3-æ¥­å‹™æŒ‡æ¨™å„€è¡¨æ¿)
  - [4. ç³»çµ±å¥åº·å„€è¡¨æ¿](#4-ç³»çµ±å¥åº·å„€è¡¨æ¿)
- [æ•…éšœæ’æŸ¥æµç¨‹](#æ•…éšœæ’æŸ¥æµç¨‹)
  - [1. å¿«é€Ÿè¨ºæ–·](#1-å¿«é€Ÿè¨ºæ–·)
  - [2. éŒ¯èª¤è¿½è¹¤](#2-éŒ¯èª¤è¿½è¹¤)
  - [3. æ•ˆèƒ½å•é¡Œè¨ºæ–·](#3-æ•ˆèƒ½å•é¡Œè¨ºæ–·)
- [ç›¸é—œæ–‡æª”](#ç›¸é—œæ–‡æª”)

---


> **ç›®çš„**ï¼šå®šç¾©ç³»çµ±ç›£æ§æŒ‡æ¨™ã€å‘Šè­¦è¦å‰‡å’Œæ—¥èªŒç®¡ç†è¦ç¯„ï¼Œç¢ºä¿ç”Ÿç”¢ç’°å¢ƒç©©å®šé‹è¡Œ

**æœ€å¾Œæ›´æ–°**ï¼š2025-11-16
**ç‰ˆæœ¬**ï¼šv1.0
**ç¶­è­·è€…**ï¼šé–‹ç™¼åœ˜éšŠ
**ç›¸é—œæŠ€è¡“**ï¼šSupabase Logs, Sentry, Vercel Analytics

- --

## ğŸ“‹ ç›®éŒ„

1. [ç›£æ§æ¶æ§‹](#ç›£æ§æ¶æ§‹)
2. [ç›£æ§æŒ‡æ¨™å®šç¾©](#ç›£æ§æŒ‡æ¨™å®šç¾©)
3. [å‘Šè­¦è¦å‰‡é…ç½®](#å‘Šè­¦è¦å‰‡é…ç½®)
4. [æ—¥èªŒç®¡ç†è¦ç¯„](#æ—¥èªŒç®¡ç†è¦ç¯„)
5. [å„€è¡¨æ¿é…ç½®](#å„€è¡¨æ¿é…ç½®)
6. [æ•…éšœæ’æŸ¥æµç¨‹](#æ•…éšœæ’æŸ¥æµç¨‹)

- --

## ç›£æ§æ¶æ§‹

### ç›£æ§å±¤ç´š

```sql
â”‚         ä½¿ç”¨è€…é«”é©—ç›£æ§ (RUM)             â”‚
â”‚    Vercel Analytics / Google Analytics  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å‰ç«¯æ‡‰ç”¨ç›£æ§                    â”‚
â”‚    Sentry (éŒ¯èª¤è¿½è¹¤ + æ•ˆèƒ½ç›£æ§)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          API å±¤ç›£æ§                      â”‚
â”‚    Supabase Logs + Custom Metrics       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         è³‡æ–™åº«ç›£æ§                       â”‚
â”‚    Supabase Database Metrics            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       åŸºç¤è¨­æ–½ç›£æ§                       â”‚
â”‚    Vercel Deployment + Edge Functions   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›£æ§å·¥å…·æ•´åˆ

| ç›£æ§å±¤ç´š | å·¥å…· | ç”¨é€” |
|---------|------|------|
| **å‰ç«¯éŒ¯èª¤** | Sentry | JavaScript éŒ¯èª¤è¿½è¹¤ã€æ•ˆèƒ½ç›£æ§ |
| **å‰ç«¯åˆ†æ** | Vercel Analytics | é é¢è¼‰å…¥æ™‚é–“ã€Core Web Vitals |
| **API ç›£æ§** | Supabase Logs | API è«‹æ±‚æ—¥èªŒã€æŸ¥è©¢æ•ˆèƒ½ |
| **è³‡æ–™åº«** | Supabase Dashboard | é€£ç·šæ•¸ã€æŸ¥è©¢æ™‚é–“ã€å„²å­˜ç©ºé–“ |
| **éƒ¨ç½²** | Vercel Dashboard | å»ºç½®ç‹€æ…‹ã€éƒ¨ç½²æ­·å²ã€å‡½æ•¸åŸ·è¡Œ |
| **ä½¿ç”¨è€…åˆ†æ** | Google Analytics | ä½¿ç”¨è€…è¡Œç‚ºã€æµé‡åˆ†æ |

- --

## ç›£æ§æŒ‡æ¨™å®šç¾©

### 1. å‰ç«¯æ•ˆèƒ½æŒ‡æ¨™

#### Core Web Vitals

**LCP (Largest Contentful Paint)**
```typescript
// ç›®æ¨™å€¼
å„ªç§€ï¼š< 2.5s
éœ€æ”¹é€²ï¼š2.5s - 4.0s
å·®ï¼š> 4.0s

// ç›£æ§æ–¹å¼
- Vercel Analytics è‡ªå‹•è¿½è¹¤
- æ‰‹å‹•åŸ‹é»æ¸¬é‡é—œéµå…ƒä»¶è¼‰å…¥æ™‚é–“
```

**FID (First Input Delay)**
```typescript
// ç›®æ¨™å€¼
å„ªç§€ï¼š< 100ms
éœ€æ”¹é€²ï¼š100ms - 300ms
å·®ï¼š> 300ms

// ç›£æ§æ–¹å¼
- ä½¿ç”¨ PerformanceObserver API
- Sentry è‡ªå‹•æ”¶é›†
```

**CLS (Cumulative Layout Shift)**
```typescript
// ç›®æ¨™å€¼
å„ªç§€ï¼š< 0.1
éœ€æ”¹é€²ï¼š0.1 - 0.25
å·®ï¼š> 0.25

// ç›£æ§æ–¹å¼
- Vercel Analytics è‡ªå‹•è¿½è¹¤
- æ‰‹å‹•æ¸¬é‡å‹•æ…‹å…§å®¹è¼‰å…¥
```

#### JavaScript éŒ¯èª¤ç‡

```typescript
// ç›£æ§æŒ‡æ¨™
éŒ¯èª¤ç‡ = (éŒ¯èª¤æ•¸ / ç¸½è«‹æ±‚æ•¸) Ã— 100%

// å‘Šè­¦é–¾å€¼
è­¦å‘Šï¼šéŒ¯èª¤ç‡ > 0.5%
åš´é‡ï¼šéŒ¯èª¤ç‡ > 1%
ç·Šæ€¥ï¼šéŒ¯èª¤ç‡ > 5%

// Sentry é…ç½®
Sentry.init({
  dsn: process.env.SENTRY_DSN,
  tracesSampleRate: 0.1, // 10% å–æ¨£
  environment: process.env.NODE_ENV
});
```

### 2. API æ•ˆèƒ½æŒ‡æ¨™

#### API å›æ‡‰æ™‚é–“

```sql
-- Supabase Logs æŸ¥è©¢
SELECT
  path,
  method,
  AVG(duration) as avg_duration,
  MAX(duration) as max_duration,
  COUNT(*) as request_count
FROM edge_logs
WHERE timestamp > NOW() - INTERVAL '1 hour'
GROUP BY path, method
ORDER BY avg_duration DESC;

-- å‘Šè­¦é–¾å€¼
P50 < 200ms
P95 < 500ms
P99 < 1000ms
```

#### API éŒ¯èª¤ç‡

```typescript
// ç›£æ§æŒ‡æ¨™
API éŒ¯èª¤ç‡ = (5xx éŒ¯èª¤æ•¸ / ç¸½è«‹æ±‚æ•¸) Ã— 100%

// å‘Šè­¦é–¾å€¼
è­¦å‘Šï¼šéŒ¯èª¤ç‡ > 0.1%
åš´é‡ï¼šéŒ¯èª¤ç‡ > 0.5%
ç·Šæ€¥ï¼šéŒ¯èª¤ç‡ > 1%

// å¸¸è¦‹éŒ¯èª¤ç¢¼åˆ†é¡
- 4xx: å®¢æˆ¶ç«¯éŒ¯èª¤ï¼ˆä¸€èˆ¬ä¸å‘Šè­¦ï¼‰
- 500: ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤ï¼ˆç«‹å³å‘Šè­¦ï¼‰
- 502: ç¶²é—œéŒ¯èª¤ï¼ˆç«‹å³å‘Šè­¦ï¼‰
- 503: æœå‹™ä¸å¯ç”¨ï¼ˆç«‹å³å‘Šè­¦ï¼‰
- 504: ç¶²é—œè¶…æ™‚ï¼ˆè­¦å‘Šï¼‰
```

#### RPC å‡½æ•¸åŸ·è¡Œ

```sql
-- è¿½è¹¤ Edge Functions åŸ·è¡Œ
SELECT
  function_name,
  AVG(execution_time) as avg_time,
  COUNT(*) as invocations,
  SUM(CASE WHEN status = 'error' THEN 1 ELSE 0 END) as error_count
FROM function_logs
WHERE timestamp > NOW() - INTERVAL '1 hour'
GROUP BY function_name;

-- å‘Šè­¦é–¾å€¼
å¹³å‡åŸ·è¡Œæ™‚é–“ > 3s
éŒ¯èª¤æ•¸ > 10 æ¬¡/å°æ™‚
```

### 3. è³‡æ–™åº«æŒ‡æ¨™

#### é€£ç·šæ± ä½¿ç”¨ç‡

```typescript
// ç›£æ§æŒ‡æ¨™
é€£ç·šæ± ä½¿ç”¨ç‡ = (ä½¿ç”¨ä¸­é€£ç·šæ•¸ / æœ€å¤§é€£ç·šæ•¸) Ã— 100%

// å‘Šè­¦é–¾å€¼
è­¦å‘Šï¼šä½¿ç”¨ç‡ > 70%
åš´é‡ï¼šä½¿ç”¨ç‡ > 85%
ç·Šæ€¥ï¼šä½¿ç”¨ç‡ > 95%

// Supabase è¨­å®š
æœ€å¤§é€£ç·šæ•¸ï¼š100 (æ ¹æ“šæ–¹æ¡ˆèª¿æ•´)
é ç•™é€£ç·šï¼š10 (ç³»çµ±ä½¿ç”¨)
```

#### æŸ¥è©¢æ•ˆèƒ½

```sql
-- æ…¢æŸ¥è©¢è¿½è¹¤
SELECT
  query,
  calls,
  mean_exec_time,
  max_exec_time
FROM pg_stat_statements
WHERE mean_exec_time > 1000 -- è¶…é 1 ç§’
ORDER BY mean_exec_time DESC
LIMIT 20;

-- å‘Šè­¦é–¾å€¼
å¹³å‡æŸ¥è©¢æ™‚é–“ > 500ms
æœ€å¤§æŸ¥è©¢æ™‚é–“ > 2s
æ…¢æŸ¥è©¢æ•¸é‡ > 100/å°æ™‚
```

#### å„²å­˜ç©ºé–“

```typescript
// ç›£æ§æŒ‡æ¨™
- è³‡æ–™åº«å¤§å°
- è³‡æ–™è¡¨å¤§å°
- Storage ä½¿ç”¨é‡

// å‘Šè­¦é–¾å€¼
è­¦å‘Šï¼šä½¿ç”¨ç‡ > 70%
åš´é‡ï¼šä½¿ç”¨ç‡ > 85%
ç·Šæ€¥ï¼šä½¿ç”¨ç‡ > 95%

// æ¯æ—¥æª¢æŸ¥
SELECT
  schemaname,
  tablename,
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size
FROM pg_tables
WHERE schemaname NOT IN ('pg_catalog', 'information_schema')
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

### 4. æ¥­å‹™æŒ‡æ¨™

#### ä½¿ç”¨è€…æ´»å‹•

```typescript
// é—œéµæ¥­å‹™æŒ‡æ¨™
- DAU (Daily Active Users)
- MAU (Monthly Active Users)
- ç™»å…¥æˆåŠŸç‡
- è¨»å†Šè½‰æ›ç‡
- ä»»å‹™å®Œæˆç‡

// å‘Šè­¦æ¢ä»¶
ç™»å…¥å¤±æ•—ç‡ > 5%
è¨»å†Šè½‰æ›ç‡ä¸‹é™ > 20%
ä»»å‹™å®Œæˆç‡ä¸‹é™ > 15%
```

#### ç³»çµ±å¯ç”¨æ€§

```typescript
// SLA ç›®æ¨™
å¯ç”¨æ€§ï¼š99.9% (æ¯æœˆåœæ©Ÿæ™‚é–“ < 43.8 åˆ†é˜)

// è¨ˆç®—æ–¹å¼
å¯ç”¨æ€§ = (ç¸½æ™‚é–“ - åœæ©Ÿæ™‚é–“) / ç¸½æ™‚é–“ Ã— 100%

// åœæ©Ÿå®šç¾©
- HTTP 5xx éŒ¯èª¤ç‡ > 10%
- API å›æ‡‰æ™‚é–“ > 10s
- å¥åº·æª¢æŸ¥å¤±æ•—
```

- --

## å‘Šè­¦è¦å‰‡é…ç½®

### å‘Šè­¦ç­‰ç´šå®šç¾©

| ç­‰ç´š | èªªæ˜ | å›æ‡‰æ™‚é–“ | é€šçŸ¥æ–¹å¼ |
|------|------|---------|---------|
| **P0 - ç·Šæ€¥** | ç³»çµ±å®Œå…¨ä¸å¯ç”¨ | ç«‹å³ (5 åˆ†é˜å…§) | ç°¡è¨Š + é›»è©± + Slack |
| **P1 - åš´é‡** | æ ¸å¿ƒåŠŸèƒ½ä¸å¯ç”¨ | 15 åˆ†é˜å…§ | Slack + Email |
| **P2 - é‡è¦** | éƒ¨åˆ†åŠŸèƒ½ç•°å¸¸ | 1 å°æ™‚å…§ | Slack |
| **P3 - è­¦å‘Š** | æ•ˆèƒ½ä¸‹é™ | 4 å°æ™‚å…§ | Email |

### å‘Šè­¦è¦å‰‡ç¯„ä¾‹

#### 1. å‰ç«¯å‘Šè­¦

```typescript
// Sentry å‘Šè­¦è¦å‰‡
{
  "name": "é«˜éŒ¯èª¤ç‡å‘Šè­¦",
  "conditions": [
    {
      "metric": "error_rate",
      "operator": ">",
      "value": 1,
      "window": "5m"
    }
  ],
  "actions": [
    {
      "type": "slack",
      "channel": "#alerts-frontend"
    }
  ],
  "severity": "P1"
}
```

#### 2. API å‘Šè­¦

```typescript
// Edge Function å‘Šè­¦
{
  "name": "API å›æ‡‰æ™‚é–“éé•·",
  "conditions": [
    {
      "metric": "p95_response_time",
      "operator": ">",
      "value": 1000,
      "window": "5m"
    }
  ],
  "actions": [
    {
      "type": "slack",
      "channel": "#alerts-backend"
    }
  ],
  "severity": "P2"
}
```

#### 3. è³‡æ–™åº«å‘Šè­¦

```sql
-- é€£ç·šæ± å‘Šè­¦
CREATE OR REPLACE FUNCTION check_connection_pool()
RETURNS void AS $$
DECLARE
  usage_rate numeric;
BEGIN
  SELECT
    (COUNT(*) * 100.0 / current_setting('max_connections')::int)
  INTO usage_rate
  FROM pg_stat_activity;

  IF usage_rate > 85 THEN
    -- ç™¼é€å‘Šè­¦
    PERFORM pg_notify('db_alert', json_build_object(
      'type', 'connection_pool',
      'severity', 'P1',
      'value', usage_rate
    )::text);
  END IF;
END;
$$ LANGUAGE plpgsql;
```

#### 4. æ¥­å‹™å‘Šè­¦

```typescript
// ç™»å…¥å¤±æ•—ç‡å‘Šè­¦
{
  "name": "ç™»å…¥å¤±æ•—ç‡éé«˜",
  "query": `
    SELECT
      COUNT(*) FILTER (WHERE status = 'failed') * 100.0 /
      COUNT(*) as failure_rate
    FROM auth_logs
    WHERE timestamp > NOW() - INTERVAL '5 minutes'
  `,
  "conditions": [
    {
      "metric": "failure_rate",
      "operator": ">",
      "value": 5
    }
  ],
  "actions": [
    {
      "type": "slack",
      "channel": "#alerts-security"
    }
  ],
  "severity": "P1"
}
```

### å‘Šè­¦æŠ‘åˆ¶è¦å‰‡

```typescript
// é¿å…å‘Šè­¦é¢¨æš´
{
  "suppression_rules": [
    {
      "name": "å¤œé–“ç¶­è­·æœŸ",
      "time_range": "02:00-04:00 GMT+8",
      "suppress_levels": ["P3", "P2"]
    },
    {
      "name": "å‘Šè­¦å»é‡",
      "window": "15m",
      "max_alerts": 3,
      "action": "group_and_send_once"
    }
  ]
}
```

- --

## æ—¥èªŒç®¡ç†è¦ç¯„

### æ—¥èªŒç­‰ç´š

| ç­‰ç´š | ç”¨é€” | ç¯„ä¾‹ |
|------|------|------|
| **ERROR** | éŒ¯èª¤è¨Šæ¯ | è³‡æ–™åº«é€£ç·šå¤±æ•—ã€API èª¿ç”¨éŒ¯èª¤ |
| **WARN** | è­¦å‘Šè¨Šæ¯ | æ•ˆèƒ½é™ç´šã€è³‡æºä¸è¶³è­¦å‘Š |
| **INFO** | ä¸€èˆ¬è¨Šæ¯ | ä½¿ç”¨è€…ç™»å…¥ã€ä»»å‹™å»ºç«‹ |
| **DEBUG** | é™¤éŒ¯è¨Šæ¯ | å‡½æ•¸åŸ·è¡Œæµç¨‹ã€è®Šæ•¸å€¼ |

### æ—¥èªŒæ ¼å¼

```typescript
// çµæ§‹åŒ–æ—¥èªŒæ ¼å¼
interface LogEntry {
  timestamp: string;        // ISO 8601 æ ¼å¼
  level: 'ERROR' | 'WARN' | 'INFO' | 'DEBUG';
  service: string;          // æœå‹™åç¨±
  message: string;          // æ—¥èªŒè¨Šæ¯
  context?: {               // ä¸Šä¸‹æ–‡è³‡è¨Š
    userId?: string;
    requestId?: string;
    ip?: string;
    userAgent?: string;
  };
  error?: {                 // éŒ¯èª¤è©³æƒ…
    name: string;
    message: string;
    stack?: string;
  };
  metadata?: Record<string, any>;  // å…¶ä»–å…ƒæ•¸æ“š
}

// ç¯„ä¾‹
{
  "timestamp": "2025-11-16T20:56:00Z",
  "level": "ERROR",
  "service": "auth-service",
  "message": "Failed to authenticate user",
  "context": {
    "userId": "user_123",
    "requestId": "req_abc",
    "ip": "192.168.1.1"
  },
  "error": {
    "name": "AuthenticationError",
    "message": "Invalid credentials",
    "stack": "..."
  }
}
```

### æ—¥èªŒè¨˜éŒ„æœ€ä½³å¯¦è¸

```typescript
// âœ… å¥½çš„æ—¥èªŒ
logger.info('User login successful', {
  userId: user.id,
  loginMethod: 'email',
  ip: request.ip
});

// âŒ ä¸å¥½çš„æ—¥èªŒ
logger.info('Login success');

// âœ… éŒ¯èª¤æ—¥èªŒ
logger.error('Database query failed', {
  error: error.message,
  query: sanitizedQuery,
  duration: queryDuration
});

// âŒ æ´©æ¼æ•æ„Ÿè³‡è¨Š
logger.error('Query failed', {
  query: 'SELECT * FROM users WHERE password = "secret123"'
});
```

### æ—¥èªŒä¿ç•™ç­–ç•¥

| æ—¥èªŒé¡å‹ | ä¿ç•™æœŸé™ | å„²å­˜ä½ç½® |
|---------|---------|---------|
| **æ‡‰ç”¨æ—¥èªŒ** | 30 å¤© | Supabase Logs |
| **éŒ¯èª¤æ—¥èªŒ** | 90 å¤© | Sentry |
| **å¯©è¨ˆæ—¥èªŒ** | 1 å¹´ | Supabase + é•·æœŸå„²å­˜ |
| **æ•ˆèƒ½æ—¥èªŒ** | 7 å¤© | Vercel Analytics |

- --

## å„€è¡¨æ¿é…ç½®

### 1. å³æ™‚ç›£æ§å„€è¡¨æ¿

**é—œéµæŒ‡æ¨™é¢æ¿**
- ç•¶å‰ç·šä¸Šä½¿ç”¨è€…æ•¸
- API è«‹æ±‚ç‡ (req/s)
- å¹³å‡å›æ‡‰æ™‚é–“
- éŒ¯èª¤ç‡
- è³‡æ–™åº«é€£ç·šæ•¸

### 2. æ•ˆèƒ½åˆ†æå„€è¡¨æ¿

**Core Web Vitals**
- LCP è¶¨å‹¢åœ–
- FID åˆ†å¸ƒåœ–
- CLS æ­·å²è¨˜éŒ„

**API æ•ˆèƒ½**
- å›æ‡‰æ™‚é–“ P50/P95/P99
- å„ç«¯é»å›æ‡‰æ™‚é–“åˆ†å¸ƒ
- æœ€æ…¢ API æ’è¡Œ

### 3. æ¥­å‹™æŒ‡æ¨™å„€è¡¨æ¿

**ä½¿ç”¨è€…æ´»å‹•**
- DAU/MAU è¶¨å‹¢
- æ–°ä½¿ç”¨è€…è¨»å†Šæ•¸
- ä½¿ç”¨è€…ç•™å­˜ç‡

**åŠŸèƒ½ä½¿ç”¨**
- å„åŠŸèƒ½ä½¿ç”¨æ¬¡æ•¸
- ä»»å‹™å®Œæˆç‡
- å•é¡Œè™•ç†æ™‚æ•ˆ

### 4. ç³»çµ±å¥åº·å„€è¡¨æ¿

**è³‡æºä½¿ç”¨**
- CPU ä½¿ç”¨ç‡
- è¨˜æ†¶é«”ä½¿ç”¨ç‡
- ç£ç¢Ÿä½¿ç”¨ç‡
- ç¶²è·¯æµé‡

- --

## æ•…éšœæ’æŸ¥æµç¨‹

### 1. å¿«é€Ÿè¨ºæ–·

```bash
# æª¢æŸ¥ç³»çµ±å¥åº·ç‹€æ…‹
curl https://api.example.com/health

# æŸ¥çœ‹æœ€è¿‘éŒ¯èª¤æ—¥èªŒ
# Supabase Dashboard â†’ Logs â†’ Filter by level:error

# æª¢æŸ¥è³‡æ–™åº«é€£ç·š
psql -h db.example.com -U postgres -c "SELECT COUNT(*) FROM pg_stat_activity;"
```

### 2. éŒ¯èª¤è¿½è¹¤

1. **è­˜åˆ¥å•é¡Œ**
   - æŸ¥çœ‹å‘Šè­¦è¨Šæ¯
   - ç¢ºèªå½±éŸ¿ç¯„åœ
   - è©•ä¼°åš´é‡ç¨‹åº¦

2. **æ”¶é›†è³‡è¨Š**
   - éŒ¯èª¤å †ç–Šè¿½è¹¤
   - ç›¸é—œæ—¥èªŒ
   - ä½¿ç”¨è€…å›å ±

3. **å®šä½æ ¹å› **
   - æª¢æŸ¥æœ€è¿‘éƒ¨ç½²
   - æŸ¥çœ‹é…ç½®è®Šæ›´
   - åˆ†ææ—¥èªŒæ¨¡å¼

4. **æ‡‰æ€¥è™•ç†**
   - å›æ»¾éƒ¨ç½²
   - é™æµä¿è­·
   - å¿«é€Ÿä¿®å¾©

### 3. æ•ˆèƒ½å•é¡Œè¨ºæ–·

```sql
-- æŸ¥æ‰¾æ…¢æŸ¥è©¢
SELECT
  query,
  calls,
  total_exec_time,
  mean_exec_time,
  max_exec_time
FROM pg_stat_statements
WHERE mean_exec_time > 100
ORDER BY total_exec_time DESC
LIMIT 10;

-- æª¢æŸ¥ç´¢å¼•ä½¿ç”¨
SELECT
  schemaname,
  tablename,
  indexname,
  idx_scan as index_scans,
  idx_tup_read as tuples_read,
  idx_tup_fetch as tuples_fetched
FROM pg_stat_user_indexes
WHERE idx_scan = 0
ORDER BY pg_relation_size(indexrelid) DESC;
```

- --

## ç›¸é—œæ–‡æª”

- [éƒ¨ç½²æŒ‡å—](./39-éƒ¨ç½²æŒ‡å—.md)
- [æ•ˆèƒ½å„ªåŒ–æŒ‡å—](./40-æ•ˆèƒ½å„ªåŒ–æŒ‡å—.md)
- [å®‰å…¨æª¢æŸ¥æ¸…å–®](./41-å®‰å…¨æª¢æŸ¥æ¸…å–®.md)
- [ç½é›£æ¢å¾©èˆ‡å‚™ä»½æŒ‡å—](./57-ç½é›£æ¢å¾©èˆ‡å‚™ä»½æŒ‡å—.md)

- --

**ç¶­è­·è€…**ï¼šé–‹ç™¼åœ˜éšŠ
**æœ€å¾Œæ›´æ–°**ï¼š2025-11-16
**ä¸‹æ¬¡å¯©æŸ¥**ï¼š2026-02-16
