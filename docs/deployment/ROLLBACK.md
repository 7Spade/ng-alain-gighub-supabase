# å›æ»¾æ­¥é©Ÿæ–‡æª” (Rollback Guide)

> **ç‰ˆæœ¬**: 1.0.0  
> **æœ€å¾Œæ›´æ–°**: 2025-11-22  
> **ç·Šæ€¥ç¨‹åº¦**: ğŸ”´ CRITICAL

---

## ğŸ“‹ ç›®éŒ„

1. [ä½•æ™‚éœ€è¦å›æ»¾](#ä½•æ™‚éœ€è¦å›æ»¾)
2. [å›æ»¾æ±ºç­–æµç¨‹](#å›æ»¾æ±ºç­–æµç¨‹)
3. [å›æ»¾å‰æº–å‚™](#å›æ»¾å‰æº–å‚™)
4. [å›æ»¾æ­¥é©Ÿ](#å›æ»¾æ­¥é©Ÿ)
5. [å›æ»¾é©—è­‰](#å›æ»¾é©—è­‰)
6. [å›æ»¾å¾Œè™•ç†](#å›æ»¾å¾Œè™•ç†)

---

## ä½•æ™‚éœ€è¦å›æ»¾

### ğŸ”´ ç·Šæ€¥å›æ»¾è§¸ç™¼æ¢ä»¶

ç«‹å³åŸ·è¡Œå›æ»¾ï¼Œå¦‚æœå‡ºç¾ä»¥ä¸‹ä»»ä¸€æƒ…æ³ï¼š

1. **æœå‹™å®Œå…¨ä¸­æ–·**
   - ç¶²ç«™ç„¡æ³•è¨ªå•ï¼ˆæŒçºŒ > 2 åˆ†é˜ï¼‰
   - 5xx éŒ¯èª¤ç‡ > 50%
   - ç”¨æˆ¶ç„¡æ³•ç™»å…¥æˆ–ä½¿ç”¨æ ¸å¿ƒåŠŸèƒ½

2. **åš´é‡æ•¸æ“šå•é¡Œ**
   - æ•¸æ“šä¸Ÿå¤±æˆ–æå£
   - æ•¸æ“šå®Œæ•´æ€§å—æ
   - å®‰å…¨æ¼æ´æš´éœ²ç”¨æˆ¶æ•¸æ“š

3. **æ€§èƒ½åš´é‡é€€åŒ–**
   - é é¢åŠ è¼‰æ™‚é–“ > 10 ç§’
   - API éŸ¿æ‡‰æ™‚é–“ > 5 ç§’
   - æœå‹™å™¨è² è¼‰ > 95%ï¼ˆæŒçºŒ > 5 åˆ†é˜ï¼‰

4. **å®‰å…¨äº‹ä»¶**
   - ç™¼ç¾åš´é‡å®‰å…¨æ¼æ´è¢«åˆ©ç”¨
   - æœªæˆæ¬Šè¨ªå•
   - DDoS æ”»æ“Š

### ğŸŸ¡ è©•ä¼°å¾Œå›æ»¾ï¼ˆ30 åˆ†é˜å…§æ±ºç­–ï¼‰

ä»¥ä¸‹æƒ…æ³éœ€è¦è©•ä¼°æ˜¯å¦å›æ»¾ï¼š

1. **éƒ¨åˆ†åŠŸèƒ½ç•°å¸¸**
   - éæ ¸å¿ƒåŠŸèƒ½ä¸å¯ç”¨
   - å½±éŸ¿ < 20% ç”¨æˆ¶
   - æœ‰æ›¿ä»£æ–¹æ¡ˆ

2. **æ€§èƒ½è¼•å¾®é€€åŒ–**
   - é é¢åŠ è¼‰æ™‚é–“å¢åŠ  2-3 ç§’
   - éé«˜å³°æ™‚æ®µå¯æ¥å—

3. **å‰ç«¯å•é¡Œ**
   - UI é¡¯ç¤ºç•°å¸¸ä½†åŠŸèƒ½å¯ç”¨
   - æ¨£å¼å•é¡Œ
   - å…¼å®¹æ€§å•é¡Œï¼ˆåƒ…å½±éŸ¿ç‰¹å®šç€è¦½å™¨ï¼‰

---

## å›æ»¾æ±ºç­–æµç¨‹

\`\`\`mermaid
flowchart TD
    A[ç™¼ç¾å•é¡Œ] --> B{å•é¡Œåš´é‡ç¨‹åº¦}
    B -->|ğŸ”´ ç·Šæ€¥| C[ç«‹å³å›æ»¾]
    B -->|ğŸŸ¡ ä¸­ç­‰| D[è©•ä¼°å½±éŸ¿]
    B -->|ğŸŸ¢ è¼•å¾®| E[è¨˜éŒ„å•é¡Œï¼Œå»¶å¾Œä¿®å¾©]
    
    D --> F{å½±éŸ¿ç¯„åœ}
    F -->|> 20% ç”¨æˆ¶| C
    F -->|< 20% ç”¨æˆ¶| G{æœ‰æ›¿ä»£æ–¹æ¡ˆ?}
    G -->|å¦| C
    G -->|æ˜¯| H[ç›£æ§ä¸¦è¨ˆåŠƒä¿®å¾©]
    
    C --> I[åŸ·è¡Œå›æ»¾]
    I --> J[é©—è­‰å›æ»¾]
    J --> K{å›æ»¾æˆåŠŸ?}
    K -->|æ˜¯| L[é€šçŸ¥åœ˜éšŠ]
    K -->|å¦| M[å‡ç´šè‡³æ›´é«˜ç´šåˆ¥]
\`\`\`

---

## å›æ»¾å‰æº–å‚™

### 1. é€šçŸ¥ç›¸é—œäººå“¡

\`\`\`bash
# é€šçŸ¥æ¸…å–®
- [ ] æŠ€è¡“è² è²¬äºº
- [ ] é–‹ç™¼åœ˜éšŠ
- [ ] é‹ç¶­åœ˜éšŠ
- [ ] ç”¢å“ç¶“ç†
- [ ] å®¢æˆ¶æ”¯æ´åœ˜éšŠ
\`\`\`

**é€šçŸ¥æ¨¡æ¿**:
\`\`\`
ç·Šæ€¥é€šçŸ¥ï¼šç”Ÿç”¢ç’°å¢ƒå›æ»¾

æ™‚é–“: [ç•¶å‰æ™‚é–“]
å•é¡Œ: [ç°¡è¿°å•é¡Œ]
å½±éŸ¿: [å½±éŸ¿ç¯„åœ]
è¡Œå‹•: å³å°‡å›æ»¾è‡³ç‰ˆæœ¬ [ç‰ˆæœ¬è™Ÿ]
é è¨ˆæ¢å¾©æ™‚é–“: [æ™‚é–“]
è² è²¬äºº: [å§“å]
\`\`\`

### 2. è¨˜éŒ„ç•¶å‰ç‹€æ…‹

\`\`\`bash
# è¨˜éŒ„ç•¶å‰ç‰ˆæœ¬
git log -1 --oneline > /tmp/current-version.txt

# è¨˜éŒ„ç•¶å‰éƒ¨ç½²ç‹€æ…‹
date >> /tmp/rollback-log.txt
echo "Current deployment hash: \$(git rev-parse HEAD)" >> /tmp/rollback-log.txt

# æˆªåœ–éŒ¯èª¤æ—¥èªŒï¼ˆå¦‚æœå¯èƒ½ï¼‰
curl https://yourdomain.com/api/health > /tmp/health-before-rollback.json
\`\`\`

### 3. ç¢ºå®šå›æ»¾ç›®æ¨™ç‰ˆæœ¬

\`\`\`bash
# æŸ¥çœ‹æœ€è¿‘çš„ç©©å®šç‰ˆæœ¬
git log --oneline -10

# æˆ–æŸ¥çœ‹ç”Ÿç”¢ç’°å¢ƒçš„ä¸Šä¸€å€‹éƒ¨ç½²
git log origin/production --oneline -10

# æ¨è–¦ï¼šå›æ»¾åˆ°ä¸Šä¸€å€‹ç©©å®šç‰ˆæœ¬
# é€šå¸¸æ˜¯ä¸Šä¸€å€‹æˆåŠŸéƒ¨ç½²çš„ commit
\`\`\`

---

## å›æ»¾æ­¥é©Ÿ

### é¸é … 1: Vercel å›æ»¾ (æœ€å¿«)

**æ­¥é©Ÿ 1: åœ¨ Vercel Dashboard å›æ»¾**

1. è¨ªå• [Vercel Dashboard](https://vercel.com/dashboard)
2. é¸æ“‡ ng-alain-gighub å°ˆæ¡ˆ
3. å‰å¾€ "Deployments" æ¨™ç±¤
4. æ‰¾åˆ°ä¸Šä¸€å€‹æˆåŠŸçš„éƒ¨ç½²
5. é»æ“Š "..." â†’ "Promote to Production"

**é è¨ˆæ™‚é–“**: 1-2 åˆ†é˜

**æ­¥é©Ÿ 2: é©—è­‰**
\`\`\`bash
# æª¢æŸ¥ç¶²ç«™æ˜¯å¦æ¢å¾©
curl -I https://yourdomain.com
# é æœŸ: HTTP/2 200

# é©—è­‰åŠŸèƒ½
curl https://yourdomain.com/api/health
\`\`\`

---

### é¸é … 2: Git + é‡æ–°éƒ¨ç½²

**æ­¥é©Ÿ 1: å›æ»¾ä»£ç¢¼**

\`\`\`bash
# 1. è¨˜éŒ„ç•¶å‰ç‹€æ…‹
git branch backup-$(date +%Y%m%d-%H%M%S)

# 2. å›æ»¾åˆ°ä¸Šä¸€å€‹ç©©å®šç‰ˆæœ¬
# æ–¹æ³• A: å›æ»¾åˆ°ç‰¹å®š commit
git checkout <stable-commit-hash>

# æ–¹æ³• B: å›æ»¾åˆ°ä¸Šä¸€å€‹ tag/release
git checkout tags/v1.0.0

# æ–¹æ³• C: å›æ»¾ä¸Šä¸€å€‹ commit
git reset --hard HEAD~1

# 3. å¼·åˆ¶æ¨é€ï¼ˆåƒ…åœ¨ç·Šæ€¥æƒ…æ³ï¼‰
# âš ï¸ è­¦å‘Šï¼šé€™æœƒæ”¹è®Šæ­·å²è¨˜éŒ„
# git push origin production --force
\`\`\`

**æ­¥é©Ÿ 2: é‡æ–°æ§‹å»º**

\`\`\`bash
# æ¸…é™¤èˆŠçš„æ§‹å»º
rm -rf dist/

# é‡æ–°æ§‹å»º
yarn build
\`\`\`

**æ­¥é©Ÿ 3: é‡æ–°éƒ¨ç½²**

**Nginx éƒ¨ç½²**:
\`\`\`bash
# å‚™ä»½ç•¶å‰éƒ¨ç½²
sudo mv /var/www/ng-alain-gighub /var/www/ng-alain-gighub.backup.$(date +%Y%m%d-%H%M%S)

# è¤‡è£½æ–°æ§‹å»º
sudo cp -r dist/ng-alain-gighub/browser /var/www/ng-alain-gighub

# è¨­ç½®æ¬Šé™
sudo chown -R www-data:www-data /var/www/ng-alain-gighub

# é‡å•Ÿ Nginx
sudo systemctl reload nginx
\`\`\`

**Vercel CLI**:
\`\`\`bash
# å¼·åˆ¶éƒ¨ç½²ç•¶å‰ç‰ˆæœ¬
vercel --prod --force
\`\`\`

**é è¨ˆæ™‚é–“**: 5-10 åˆ†é˜

---

### é¸é … 3: Docker å›æ»¾

**æ­¥é©Ÿ 1: å›æ»¾åˆ°ä¸Šä¸€å€‹æ˜ åƒ**

\`\`\`bash
# 1. åˆ—å‡ºå¯ç”¨çš„æ˜ åƒ
docker images ng-alain-gighub

# 2. åœæ­¢ç•¶å‰å®¹å™¨
docker stop ng-alain-gighub

# 3. ç§»é™¤ç•¶å‰å®¹å™¨
docker rm ng-alain-gighub

# 4. é‹è¡ŒèˆŠç‰ˆæœ¬æ˜ åƒ
docker run -d -p 80:80 --name ng-alain-gighub ng-alain-gighub:v1.0.0

# æˆ–ä½¿ç”¨ docker-compose
docker-compose down
docker-compose up -d
\`\`\`

**é è¨ˆæ™‚é–“**: 2-3 åˆ†é˜

---

## å›æ»¾é©—è­‰

### 1. è‡ªå‹•åŒ–é©—è­‰è…³æœ¬

\`\`\`bash
#!/bin/bash
# rollback-verify.sh

echo "é–‹å§‹é©—è­‰å›æ»¾..."

# æª¢æŸ¥ç¶²ç«™å¯è¨ªå•æ€§
if curl -f -s https://yourdomain.com > /dev/null; then
    echo "âœ“ ç¶²ç«™å¯è¨ªå•"
else
    echo "âœ— ç¶²ç«™ä¸å¯è¨ªå•"
    exit 1
fi

# æª¢æŸ¥ API å¥åº·
health=$(curl -s https://yourdomain.com/api/health)
if echo "\$health" | grep -q "ok"; then
    echo "âœ“ API å¥åº·"
else
    echo "âœ— API ç•°å¸¸"
    exit 1
fi

# æª¢æŸ¥ç™»å…¥åŠŸèƒ½
# æ·»åŠ ç™»å…¥æ¸¬è©¦...

echo "âœ“ å›æ»¾é©—è­‰æˆåŠŸ"
\`\`\`

### 2. æ‰‹å‹•é©—è­‰æ¸…å–®

- [ ] **ç¶²ç«™å¯è¨ªå•**: https://yourdomain.com æ­£å¸¸åŠ è¼‰
- [ ] **ç”¨æˆ¶å¯ç™»å…¥**: æ¸¬è©¦ç”¨æˆ¶èªè­‰æµç¨‹
- [ ] **æ ¸å¿ƒåŠŸèƒ½**: æ¸¬è©¦ä¸»è¦æ¥­å‹™åŠŸèƒ½
  - [ ] å•é¡Œåˆ—è¡¨åŠ è¼‰
  - [ ] å‰µå»ºæ–°å•é¡Œ
  - [ ] è—åœ–ç®¡ç†
  - [ ] æ–‡æª”ä¸Šå‚³
- [ ] **API èª¿ç”¨**: æ‰€æœ‰ API è«‹æ±‚æˆåŠŸ
- [ ] **æ•¸æ“šå®Œæ•´æ€§**: é©—è­‰æ•¸æ“šæœªæå£
- [ ] **æ€§èƒ½æ­£å¸¸**: é é¢åŠ è¼‰æ™‚é–“ < 3 ç§’

### 3. ç›£æ§æª¢æŸ¥

\`\`\`bash
# æª¢æŸ¥éŒ¯èª¤æ—¥èªŒ
tail -f /var/log/nginx/ng-alain-gighub_error.log

# æª¢æŸ¥è¨ªå•æ—¥èªŒ
tail -f /var/log/nginx/ng-alain-gighub_access.log | grep "200"

# ç›£æ§æœå‹™å™¨è² è¼‰
top -b -n 1 | head -5
\`\`\`

---

## å›æ»¾å¾Œè™•ç†

### 1. æ›´æ–°æ–‡æª”

\`\`\`markdown
# åœ¨ CHANGELOG.md ä¸­è¨˜éŒ„
## [Rollback] - 2025-11-22

### åŸå› 
- [ç°¡è¿°å›æ»¾åŸå› ]

### å›æ»¾ç‰ˆæœ¬
- From: [å¤±æ•—ç‰ˆæœ¬]
- To: [ç©©å®šç‰ˆæœ¬]

### å½±éŸ¿
- [å½±éŸ¿ç¯„åœå’Œç”¨æˆ¶]

### å¾ŒçºŒè¡Œå‹•
- [ä¿®å¾©è¨ˆåŠƒ]
\`\`\`

### 2. é€šçŸ¥ç”¨æˆ¶ï¼ˆå¦‚éœ€è¦ï¼‰

**é€šçŸ¥æ¨¡æ¿**:
\`\`\`
æœå‹™æ¢å¾©é€šçŸ¥

æˆ‘å€‘çš„æœå‹™å·²æ¢å¾©æ­£å¸¸ã€‚

å•é¡Œ: [ç°¡è¿°]
å½±éŸ¿æ™‚é–“: [é–‹å§‹æ™‚é–“] è‡³ [çµæŸæ™‚é–“]
å—å½±éŸ¿åŠŸèƒ½: [åˆ—å‡º]

æˆ‘å€‘å·²æ¡å–æªæ–½é˜²æ­¢é¡ä¼¼å•é¡Œå†æ¬¡ç™¼ç”Ÿã€‚
æ„Ÿè¬æ‚¨çš„è€å¿ƒå’Œç†è§£ã€‚

å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹è¯ç¹«: support@yourdomain.com
\`\`\`

### 3. äº‹å¾Œåˆ†æ (Post-Mortem)

**åœ¨ 24 å°æ™‚å…§å®Œæˆ**:

1. **å•é¡Œæè¿°**
   - ä½•æ™‚ç™¼ç¾å•é¡Œ
   - å•é¡Œå…·é«”è¡¨ç¾
   - å½±éŸ¿ç¯„åœ

2. **æ ¹æœ¬åŸå› **
   - ç‚ºä»€éº¼æœƒç™¼ç”Ÿ
   - å“ªäº›ç’°ç¯€å¤±æ•ˆ

3. **æ™‚é–“ç·š**
   - éƒ¨ç½²æ™‚é–“
   - ç™¼ç¾æ™‚é–“
   - å›æ»¾æ™‚é–“
   - æ¢å¾©æ™‚é–“

4. **å½±éŸ¿è©•ä¼°**
   - å—å½±éŸ¿ç”¨æˆ¶æ•¸
   - æ•¸æ“šå®Œæ•´æ€§
   - æ¥­å‹™å½±éŸ¿

5. **é˜²ç¯„æªæ–½**
   - çŸ­æœŸæªæ–½
   - é•·æœŸæ”¹é€²
   - æ¸¬è©¦å¢å¼·

6. **è¡Œå‹•é …**
   - è²¬ä»»äºº
   - å®ŒæˆæœŸé™
   - é©—è­‰æ¨™æº–

### 4. ä¿®å¾©è¨ˆåŠƒ

\`\`\`markdown
# ä¿®å¾©è¿½è¹¤

## Issue #[ç·¨è™Ÿ]: [å•é¡Œæ¨™é¡Œ]

### å•é¡Œæè¿°
[è©³ç´°æè¿°å°è‡´å›æ»¾çš„å•é¡Œ]

### ä¿®å¾©æ–¹æ¡ˆ
[æå‡ºçš„ä¿®å¾©æ–¹æ¡ˆ]

### æ¸¬è©¦è¨ˆåŠƒ
[å¦‚ä½•æ¸¬è©¦ä¿®å¾©]

### éƒ¨ç½²è¨ˆåŠƒ
[ä½•æ™‚é‡æ–°éƒ¨ç½²ï¼Œéœ€è¦å“ªäº›æº–å‚™]

### è²¬ä»»äºº
[æŒ‡å®šè² è²¬äºº]

### å®ŒæˆæœŸé™
[è¨­å®šæœŸé™]
\`\`\`

---

## ç·Šæ€¥è¯çµ¡

### å›æ»¾æ±ºç­–è€…

| è§’è‰² | å§“å | è¯çµ¡æ–¹å¼ | å‚™è¨» |
|------|------|----------|------|
| æŠ€è¡“è² è²¬äºº | [å§“å] | [é›»è©±/Email] | æœ€çµ‚æ±ºç­–è€… |
| DevOps Lead | [å§“å] | [é›»è©±/Email] | åŸ·è¡Œå›æ»¾ |
| ç”¢å“è² è²¬äºº | [å§“å] | [é›»è©±/Email] | æ¥­å‹™å½±éŸ¿è©•ä¼° |
| æ”¯æ´åœ˜éšŠ | [å§“å] | [é›»è©±/Email] | ç”¨æˆ¶æºé€š |

### å‡ç´šæµç¨‹

å¦‚æœå›æ»¾å¤±æ•—æˆ–å•é¡ŒæŒçºŒï¼š

1. **ç¬¬ä¸€ç´š**: æŠ€è¡“è² è²¬äºº (+886-xxx-xxxx)
2. **ç¬¬äºŒç´š**: CTO (+886-xxx-xxxx)
3. **ç¬¬ä¸‰ç´š**: å¤–éƒ¨å°ˆå®¶æ”¯æ´

---

## ç›¸é—œæ–‡æª”

- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md)
- [æ¶æ§‹æ–‡æª”](../20-å®Œæ•´æ¶æ§‹æµç¨‹åœ–.mermaid.md)
- [ç›£æ§æ‰‹å†Š](./MONITORING.md)

---

## å¿«é€Ÿå‘½ä»¤åƒè€ƒ

\`\`\`bash
# Vercel å›æ»¾ï¼ˆæ¨è–¦ï¼‰
# åœ¨ Dashboard ä¸­é»æ“Š Promote to Production

# Git å›æ»¾
git checkout <stable-commit>
yarn build
vercel --prod

# Nginx å›æ»¾
sudo mv /var/www/ng-alain-gighub.backup.YYYYMMDD /var/www/ng-alain-gighub
sudo systemctl reload nginx

# Docker å›æ»¾
docker stop ng-alain-gighub
docker rm ng-alain-gighub
docker run -d -p 80:80 --name ng-alain-gighub ng-alain-gighub:v1.0.0
\`\`\`

---

**ç‰ˆæœ¬**: 1.0.0  
**ç¶­è­·è€…**: é–‹ç™¼åœ˜éšŠ  
**ç·Šæ€¥ç†±ç·š**: +886-xxx-xxxx  
**æœ€å¾Œå¯©æŸ¥**: 2025-11-22
