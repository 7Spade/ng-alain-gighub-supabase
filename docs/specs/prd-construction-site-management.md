# PRD: 工地施工進度追蹤管理系統

## 1. 產品概述

### 1.1 文件標題與版本

- **PRD**: 工地施工進度追蹤管理系統 (Construction Site Management System)
- **版本**: 1.0.0
- **建立日期**: 2025-11-26
- **最後更新**: 2025-11-26

### 1.2 產品摘要

工地施工進度追蹤管理系統是一個專為台灣營造業設計的企業級應用程式，旨在解決工地現場管理的痛點。本系統整合了施工進度追蹤、品質驗收、每日施工日誌、任務管理等核心功能，透過視覺化的樹狀任務結構與即時狀態膠囊顯示，讓工地管理更加直覺且高效。

系統基於現代化的技術架構（Angular 20 + ng-alain + Supabase），採用 Git-like 的藍圖分支模式，支援多組織協作的承攬模式。現有的帳戶體系（用戶、組織、團隊）已經建立完成，本 PRD 將聚焦於核心業務功能的完整規劃，並評估現有帳戶體系的優化需求。

主要目標使用者包括：營造公司管理層、工地主任、施工人員、品管人員、以及業主。系統特別針對台灣工地環境進行優化，包括離線功能支援、在地化介面、以及符合台灣法規的文件管理。

---

## 2. 目標

### 2.1 商業目標

- 提升營造公司專案管理效率達 40% 以上
- 減少因溝通不良導致的施工錯誤與返工成本
- 建立可追溯的品質驗收記錄，降低法律糾紛風險
- 提供即時進度報告，提升業主信任度與滿意度
- 透過數據分析優化資源配置，降低專案成本
- 建立營造業數位轉型的標竿解決方案

### 2.2 使用者目標

- **專案經理**: 即時掌握所有專案進度，快速識別風險項目
- **工地主任**: 簡化每日報告流程，一鍵完成施工日誌
- **施工人員**: 清楚了解工作任務，快速回報完成狀態
- **品管人員**: 系統化品質檢查流程，降低人為疏失
- **業主**: 透明化專案進度，隨時查看施工狀況與品質報告
- **所有使用者**: 即使在網路不穩定的工地現場也能順利使用

### 2.3 非目標

- 不包含財務會計功能（如請款、付款管理）
- 不包含人力資源管理功能（如薪資計算、出勤管理）
- 不包含材料採購與庫存管理功能
- 不包含 BIM 模型整合功能（未來版本考慮）
- 不支援 Windows/macOS 桌面原生應用程式（僅 Web 應用）
- 第一版不支援多語系（僅繁體中文）

---

## 3. 使用者角色

### 3.1 關鍵使用者類型

- **超級管理員 (Super Admin)**: 系統最高權限者，管理所有組織與系統設定
- **組織管理員 (Organization Admin)**: 組織的管理者，管理組織內所有專案與成員
- **專案經理 (Project Manager)**: 負責特定藍圖/專案的整體管理
- **工地主任 (Site Director)**: 工地現場最高負責人，負責日常施工管理
- **施工人員 (Worker)**: 實際執行施工任務的人員
- **品管人員 (QA Staff)**: 負責品質檢查與驗收的人員
- **觀察者 (Observer)**: 只讀權限，通常為業主或監造單位

### 3.2 基本角色描述

- **超級管理員**: 擁有系統所有權限，可管理所有組織、設定系統參數、查看全域數據。通常為系統營運團隊。

- **組織管理員**: 負責管理組織帳戶，包括新增/移除成員、建立團隊、設定組織層級權限。可建立與管理組織的所有藍圖。

- **專案經理**: 負責單一或多個藍圖的整體規劃與管理，包括建立任務結構、設定里程碑、分配任務、審核變更請求（PR）。

- **工地主任**: 工地現場的管理者，負責每日施工日誌、任務進度更新、品質檢查協調、問題回報與處理。

- **施工人員**: 執行具體施工任務，回報任務完成狀態、上傳施工照片、提交工作至暫存區。

- **品管人員**: 執行品質檢查、填寫檢查清單、上傳驗收照片、開立品質異常問題單。

- **觀察者**: 唯讀權限使用者，可查看專案進度、報表、照片，但無法進行任何修改操作。

### 3.3 角色權限存取矩陣

| 功能/角色 | 超級管理員 | 組織管理員 | 專案經理 | 工地主任 | 施工人員 | 品管人員 | 觀察者 |
|-----------|:----------:|:----------:|:--------:|:--------:|:--------:|:--------:|:------:|
| 系統設定管理 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 組織管理 | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 建立藍圖 | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| 管理藍圖 | ✅ | ✅ | ✅ | 🔶 | ❌ | ❌ | ❌ |
| 建立/編輯任務 | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ |
| 更新任務進度 | ✅ | ✅ | ✅ | ✅ | ✅ | 🔶 | ❌ |
| 提交每日報告 | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ |
| 品質驗收 | ✅ | ✅ | ✅ | ✅ | ❌ | ✅ | ❌ |
| 最終驗收 | ✅ | ✅ | ✅ | 🔶 | ❌ | 🔶 | ❌ |
| 問題管理 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ |
| 查看報表 | ✅ | ✅ | ✅ | ✅ | 🔶 | 🔶 | ✅ |
| 審核 PR | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| Fork 分支 | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |

說明：✅ 完整權限 | 🔶 有限權限 | ❌ 無權限

---

## 4. 功能需求

### 4.1 帳戶體系優化（優先級：高）

現有帳戶體系（用戶、組織、團隊）已實現基礎功能，需進行以下優化：

- **效能優化**:
  - 實現帳戶資料快取策略
  - 優化 RLS 查詢效能（已有 `get_user_account_id()` 函數避免遞迴）
  - 組織成員清單分頁載入
  
- **安全性強化**:
  - 實現 Session 自動刷新機制
  - 增加登入設備管理功能
  - 實現操作審計日誌
  
- **使用者體驗**:
  - 優化帳戶切換流程（組織/團隊切換）
  - 增加帳戶偏好設定（通知、主題、語言）
  - 改善邀請成員流程

### 4.2 藍圖系統（優先級：高）

- **藍圖建立與管理**:
  - 建立藍圖（名稱、描述、開始/結束日期、設定）
  - 藍圖狀態管理（規劃中/進行中/暫停/完成/封存）
  - 藍圖設定（工作日曆、通知規則、自訂欄位）
  - 藍圖擁有者轉移
  
- **Git-like 分支系統**:
  - 主分支（Main Branch）管理
  - Fork 給協作組織（1:1 承攬關係）
  - 組織分支建立與管理
  - Pull Request 提交與審核
  - PR 合併與衝突解決
  
- **分支權限控制**:
  - 擁有者：完全控制任務結構
  - 協作組織：僅操作承攬欄位（進度、狀態、照片）
  - 觀察者：唯讀存取

### 4.3 任務系統（優先級：高）

- **樹狀任務結構**:
  - 無層級限制的階層結構
  - 父子任務關聯
  - 任務排序與拖拉調整
  - 任務展開/收合
  - 視覺化縮排顯示
  
- **任務膠囊狀態顯示**:
  - 層級標識（深度指示器）
  - 優先級標籤（低/中/高/緊急）
  - 進度百分比（圓形進度環）
  - 狀態標籤：
    - 🔵 待處理 (pending)
    - 🟢 進行中 (in_progress)
    - 🟡 暫存中 (staging)
    - 🟠 品管中 (in_qa)
    - 🔴 驗收中 (in_inspection)
    - ⬜ 已完成 (completed)
    - ⚫ 已取消 (cancelled)
  - 負責人頭像（可多人）
  - 截止日期（過期標紅）
  - 問題數量徽章
  
- **完工圖片顯示**:
  - 任務卡片內嵌縮圖
  - 點擊放大檢視
  - 支援多張圖片輪播
  - 圖片上傳進度顯示
  - 圖片 EXIF 資訊顯示（拍攝時間、地點）
  
- **任務操作**:
  - 任務建立（僅藍圖擁有者）
  - 任務指派（個人/團隊/組織）
  - 任務狀態更新
  - 任務評論與討論
  - 任務時間記錄
  
- **48小時暫存區**:
  - 提交至暫存區
  - 暫存區內容預覽
  - 48小時內可撤回
  - 暫存區過期自動確認
  - 分階段確認機制

### 4.4 施工進度追蹤（優先級：高）

- **進度儀表板**:
  - 整體完成率顯示
  - 計劃 vs 實際進度曲線圖
  - 里程碑追蹤時間軸
  - 進度風險預警
  - 關鍵路徑標示
  
- **進度更新**:
  - 批次進度更新
  - 進度計算規則（加權/等權）
  - 自動進度彙總（子任務→父任務）
  - 進度歷史記錄
  
- **預警機制**:
  - 進度落後警示（黃燈/紅燈）
  - 任務逾期提醒
  - 里程碑逼近通知
  - 客製化警示規則

### 4.5 品質驗收系統（優先級：高）

- **品質檢查清單**:
  - 清單模板管理
  - 自訂檢查項目
  - 檢查項目分類
  - 評分標準定義
  
- **驗收流程**:
  - 發起驗收申請
  - 品管人員指派
  - 檢查項目逐一確認
  - 評分與備註
  - 驗收結果判定（通過/不通過/有條件通過）
  
- **驗收照片**:
  - 前/中/後對比照片
  - 缺陷標記照片
  - 照片批次上傳
  - 照片分類標籤
  
- **串驗收功能**:
  - 多階段驗收流程定義
  - 驗收鏈追蹤
  - 階段性驗收結果記錄
  - 驗收簽核流程
  
- **最終驗收**:
  - 初步驗收
  - 最終驗收
  - 保固驗收
  - 責任切割記錄
  - 驗收報告產出

### 4.6 每日施工日誌（優先級：高）

- **日誌填寫**:
  - 日期選擇（預設當日）
  - 工作摘要（文字描述）
  - 工作時數記錄
  - 工人數量統計
  - 材料使用記錄
  - 機具使用記錄
  
- **照片管理**:
  - 批次照片上傳
  - 照片壓縮優化
  - 離線照片暫存
  - EXIF 資訊自動擷取
  - 照片分類標籤
  - 照片浮水印（選項）
  
- **天氣整合**:
  - 自動取得天氣資訊
  - 天氣 API 整合
  - 天氣資料快取
  - 手動修正功能
  
- **日誌管理**:
  - 日誌清單檢視
  - 日誌搜尋與篩選
  - 日誌匯出（PDF/Excel）
  - 日誌簽核流程

### 4.7 問題追蹤系統（優先級：中）

- **問題開立**:
  - 手動開立問題
  - 驗收不合格自動開立
  - 系統檢測自動開立
  - 問題分類
  - 嚴重程度（低/中/高/緊急）
  
- **問題處理**:
  - 問題指派
  - 處理進度更新
  - 處理記錄追蹤
  - 問題照片上傳
  - 問題關閉確認
  
- **問題流程**:
  - 新建 → 指派 → 處理中 → 待確認 → 已解決 → 已關閉
  - 重新開啟功能
  - 轉移處理人
  - 升級問題嚴重度
  
- **跨分支同步**:
  - 問題即時同步至主分支
  - Realtime 訂閱更新
  - 問題狀態統一可見

### 4.8 協作溝通模組（優先級：中）

- **討論區**:
  - 實體關聯討論（任務/問題/PR/驗收）
  - 巢狀回覆
  - @提及通知
  - 附件支援
  - Realtime 即時更新
  
- **通知中心**:
  - 站內通知
  - Email 通知
  - 推播通知（未來版本）
  - 通知規則自訂
  - 批次已讀
  
- **待辦中心**:
  - 個人待辦清單
  - 五狀態分類：
    - 🟦 待執行
    - 🟨 暫存中
    - 🟧 品管中
    - 🟥 驗收中
    - ⚠️ 問題追蹤
  - 優先級排序
  - 截止日期提醒

### 4.9 報表與分析（優先級：中）

- **進度報表**:
  - 整體進度報表
  - 分區/分階段進度
  - 進度趨勢分析
  - 計劃 vs 實際對比
  
- **品質報表**:
  - 驗收統計報表
  - 缺陷率分析
  - 品質趨勢圖
  - 問題分類統計
  
- **工時報表**:
  - 人員工時統計
  - 任務工時分析
  - 工時趨勢圖
  - 效率指標計算
  
- **報表匯出**:
  - PDF 格式
  - Excel 格式
  - 報表排程（自動生成）
  - 報表訂閱

---

## 5. 使用者體驗

### 5.1 進入點與首次使用者流程

- **註冊流程**:
  1. Email 註冊或 Google/GitHub OAuth
  2. 完成個人資料設定
  3. 選擇角色偏好
  4. 引導式功能介紹
  5. 建立/加入組織
  
- **首次登入**:
  1. 儀表板總覽
  2. 功能導覽教學
  3. 快速建立第一個藍圖（或加入現有藍圖）
  4. 設定通知偏好

### 5.2 核心體驗

- **儀表板首頁**:
  - 待辦事項快速存取
  - 進度摘要卡片
  - 最近活動時間軸
  - 快速操作按鈕
  - 確保載入時間 < 3 秒
  
- **任務樹狀圖**:
  - 流暢的展開/收合動畫
  - 拖拉排序即時反饋
  - 膠囊狀態一目瞭然
  - 側邊詳情面板
  - 確保大量任務（1000+）仍保持流暢
  
- **照片上傳**:
  - 批次選擇上傳
  - 上傳進度顯示
  - 背景上傳（不阻塞操作）
  - 壓縮優化（自動）
  - 離線暫存（網路恢復後同步）
  
- **即時協作**:
  - 多人同時編輯提示
  - 即時留言更新
  - 狀態變更即時反映
  - 衝突處理機制

### 5.3 進階功能與邊界情況

- **離線支援**:
  - Service Worker 快取
  - 離線資料讀取
  - 離線操作暫存
  - 同步衝突解決
  - 同步狀態指示
  
- **大量資料處理**:
  - 虛擬捲動（Virtual Scrolling）
  - 分頁載入
  - 懶載入圖片
  - 資料快取策略
  
- **錯誤處理**:
  - 友善錯誤訊息
  - 自動重試機制
  - 錯誤回報功能
  - 降級體驗

### 5.4 UI/UX 亮點

- **視覺設計**:
  - 符合 ng-zorro-antd 設計語言
  - 深色/淺色主題切換
  - 響應式設計（桌面/平板/手機）
  - 一致的圖示系統
  
- **互動設計**:
  - 骨架屏載入動畫
  - 操作成功/失敗反饋
  - 危險操作確認
  - 鍵盤快捷鍵支援
  
- **無障礙設計**:
  - ARIA 標籤
  - 螢幕閱讀器支援
  - 色盲友善配色
  - 字級調整

---

## 6. 敘事

小明是一家營造公司的工地主任，每天需要管理超過 50 項施工任務、協調 30 位工人、處理 3 家分包商的工作回報。過去，他使用 Excel 追蹤進度、LINE 群組溝通協調、紙本表單記錄品質檢查，工作繁瑣且容易出錯。

導入「工地施工進度追蹤管理系統」後，小明每天早上打開系統，就能在儀表板看到所有任務的即時進度。樹狀圖上的膠囊清楚顯示哪些任務延遲、哪些待驗收、哪些有問題需處理。

下午巡視工地時，小明使用手機 App 直接拍照上傳，系統自動記錄照片的時間與位置。完成任務後，他一鍵提交到暫存區，如果發現資料有誤，48 小時內都能撤回修改。

品管人員老李收到驗收通知，按照系統的檢查清單逐項確認，發現一處缺陷後直接拍照標記，系統自動開立問題單並通知相關人員。所有問題都會同步到主分支，專案經理在辦公室就能即時掌握。

到了月底，財務部門需要進度報告，系統自動生成包含進度曲線、品質統計、工時記錄的完整報告，一鍵匯出 PDF 就能交付。

透過這套系統，小明每天節省 2 小時的文書作業時間，專案延遲率降低 30%，品質問題發現時間縮短 50%，業主滿意度大幅提升。

---

## 7. 成功指標

### 7.1 使用者指標

| 指標 | 目標值 | 衡量方式 |
|------|--------|----------|
| 日活躍使用者 (DAU) | 專案成員 80%+ | 系統登入統計 |
| 任務更新頻率 | 每日至少 1 次/人 | 任務操作記錄 |
| 日誌提交率 | 工作日 95%+ | 日誌提交統計 |
| 照片上傳量 | 每任務 3+ 張 | 照片上傳統計 |
| 功能使用率 | 核心功能 70%+ | 功能使用統計 |
| 使用者滿意度 (NPS) | > 50 | 定期問卷調查 |

### 7.2 商業指標

| 指標 | 目標值 | 衡量方式 |
|------|--------|----------|
| 專案延遲率降低 | 30%+ | 專案完成統計 |
| 文書作業時間節省 | 40%+ | 使用者回饋 |
| 品質問題發現時間 | 縮短 50% | 問題開立統計 |
| 返工率降低 | 20%+ | 品質報表 |
| 客戶滿意度 | 提升 25%+ | 客戶回饋 |
| 系統採用率 | 新專案 100% | 藍圖建立統計 |

### 7.3 技術指標

| 指標 | 目標值 | 衡量方式 |
|------|--------|----------|
| 頁面載入時間 | < 3 秒 | 效能監控 |
| API 回應時間 | < 500ms (P95) | API 監控 |
| 系統可用性 | 99.9% | 監控告警 |
| 錯誤率 | < 0.1% | 錯誤追蹤 |
| 離線同步成功率 | 99%+ | 同步日誌 |
| 照片上傳成功率 | 99.5%+ | 上傳統計 |

---

## 8. 技術考量

### 8.1 整合點

- **Supabase Auth**: 用戶認證、Session 管理、JWT Token
- **Supabase Database**: PostgreSQL 資料存儲、RLS 權限控制
- **Supabase Storage**: 照片與文件存儲、CDN 分發
- **Supabase Realtime**: 即時訂閱更新、協作同步
- **Supabase Edge Functions**: 複雜業務邏輯、第三方 API 整合
- **天氣 API**: 中央氣象署或第三方天氣服務
- **地圖服務**: Google Maps 或 OpenStreetMap（地點標記）
- **Email 服務**: Supabase 內建或 SendGrid（通知郵件）

### 8.2 資料存儲與隱私

- **資料分類**:
  - 敏感資料：用戶密碼（已 Hash）、認證 Token
  - 個人資料：姓名、Email、電話、頭像
  - 業務資料：任務、日誌、驗收記錄、照片
  - 系統資料：設定、日誌、快取
  
- **存儲策略**:
  - 照片：Supabase Storage + CDN，自動壓縮縮圖
  - 文件：Supabase Storage，版本控制
  - 快取：PostgreSQL analytics_cache 表 + 前端 IndexedDB
  
- **隱私保護**:
  - RLS 政策確保資料隔離
  - 照片 EXIF 敏感資訊處理（選擇性保留）
  - 軟刪除機制（30 天保留期）
  - 資料匯出功能（GDPR 合規）
  
- **備份策略**:
  - 每日自動備份
  - 跨區域備援
  - 30 天備份保留

### 8.3 擴展性與效能

- **前端效能**:
  - 懶載入路由與元件
  - 虛擬捲動處理大量資料
  - Service Worker 離線快取
  - 圖片懶載入與漸進式載入
  - Angular OnPush 變更偵測策略
  
- **後端效能**:
  - PostgreSQL 索引優化
  - Materialized Views 報表加速
  - RPC 函數批次操作
  - Edge Functions 邊緣運算
  
- **擴展性設計**:
  - 多租戶架構（RLS 隔離）
  - 資料分區策略（按時間/組織）
  - 讀寫分離（必要時）
  - CDN 靜態資源加速

### 8.4 潛在挑戰

| 挑戰 | 風險等級 | 應對策略 |
|------|----------|----------|
| 工地網路不穩定 | 高 | Service Worker 離線支援、背景同步、衝突解決機制 |
| 大量照片上傳 | 高 | 背景上傳、自動壓縮、分片上傳、斷點續傳 |
| 複雜權限邏輯 | 中 | 完善的 RLS 政策、前端權限快取、權限測試套件 |
| 即時同步效能 | 中 | Realtime 訂閱優化、訊息聚合、節流機制 |
| 報表生成效能 | 中 | Materialized Views、預計算快取、報表排程 |
| 多組織協作衝突 | 中 | PR 機制、衝突偵測、合併策略 |

---

## 9. 里程碑與排程

### 9.1 專案規模估計

- **規模**: 大型專案
- **預估時程**: 16-20 週
- **團隊規模**: 4-6 人

### 9.2 團隊組成

- **前端開發**: 2 人（Angular 專家）
- **後端開發**: 1 人（Supabase/PostgreSQL 專家）
- **UI/UX 設計**: 1 人
- **QA 測試**: 1 人
- **產品經理**: 1 人（兼任 Scrum Master）

### 9.3 階段規劃

#### 第一階段：基礎設施優化（第 1-2 週）

**目標**: 優化現有帳戶體系，完善基礎設施

**交付項目**:
- [ ] 帳戶體系效能優化
- [ ] RLS 政策完善與測試
- [ ] 基礎 UI 元件庫建立
- [ ] 開發環境與 CI/CD 優化

#### 第二階段：藍圖與任務核心（第 3-6 週）

**目標**: 完成藍圖系統與任務樹狀結構

**交付項目**:
- [ ] 藍圖 CRUD 功能
- [ ] 任務樹狀結構 UI
- [ ] 任務膠囊狀態顯示
- [ ] 任務基礎操作（建立/編輯/刪除/排序）
- [ ] 48 小時暫存區機制

#### 第三階段：進度與日誌（第 7-9 週）

**目標**: 完成進度追蹤與每日日誌功能

**交付項目**:
- [ ] 進度儀表板
- [ ] 進度更新與計算
- [ ] 每日日誌填寫
- [ ] 照片上傳功能
- [ ] 天氣整合

#### 第四階段：品質驗收（第 10-12 週）

**目標**: 完成品質驗收系統

**交付項目**:
- [ ] 檢查清單管理
- [ ] 驗收流程實作
- [ ] 驗收照片功能
- [ ] 串驗收功能
- [ ] 自動問題開立

#### 第五階段：協作與通知（第 13-15 週）

**目標**: 完成協作溝通與通知系統

**交付項目**:
- [ ] 討論區功能
- [ ] 通知中心
- [ ] 待辦中心
- [ ] 分支與 PR 功能
- [ ] Realtime 同步優化

#### 第六階段：報表與優化（第 16-18 週）

**目標**: 完成報表系統，進行整體優化

**交付項目**:
- [ ] 進度報表
- [ ] 品質報表
- [ ] 工時報表
- [ ] 效能優化
- [ ] 離線功能完善
- [ ] UAT 測試
- [ ] 文件完善

---

## 10. 使用者故事

### 10.1 帳戶與認證

#### GH-001: 使用者註冊

- **ID**: GH-001
- **描述**: 作為一個新使用者，我希望能夠註冊帳號，以便使用系統功能。
- **驗收標準**:
  - 可使用 Email 註冊
  - 可使用 Google OAuth 註冊
  - 註冊時需填寫姓名
  - 密碼需符合複雜度要求（8 字元以上，包含大小寫與數字）
  - 註冊後需驗證 Email
  - 驗證完成後自動導向首頁

#### GH-002: 使用者登入

- **ID**: GH-002
- **描述**: 作為一個已註冊使用者，我希望能夠登入系統，以便存取我的資料。
- **驗收標準**:
  - 可使用 Email/密碼登入
  - 可使用 Google OAuth 登入
  - 登入錯誤需顯示友善提示
  - 連續 5 次登入失敗需暫時鎖定
  - 支援「記住我」功能
  - 登入後導向上次瀏覽頁面或儀表板

#### GH-003: 密碼重設

- **ID**: GH-003
- **描述**: 作為一個忘記密碼的使用者，我希望能夠重設密碼。
- **驗收標準**:
  - 可透過 Email 發送重設連結
  - 重設連結 24 小時內有效
  - 重設密碼需符合複雜度要求
  - 重設成功後自動登入

#### GH-004: 個人資料管理

- **ID**: GH-004
- **描述**: 作為一個使用者，我希望能夠管理我的個人資料。
- **驗收標準**:
  - 可修改姓名、電話、頭像
  - 頭像支援圖片上傳與裁剪
  - 可變更 Email（需重新驗證）
  - 可變更密碼（需輸入原密碼）
  - 可設定通知偏好
  - 可設定介面偏好（主題、語言）

### 10.2 組織與團隊

#### GH-005: 建立組織

- **ID**: GH-005
- **描述**: 作為一個使用者，我希望能夠建立組織，以便管理公司專案。
- **驗收標準**:
  - 可輸入組織名稱、描述、Logo
  - 建立者自動成為組織擁有者
  - 可設定組織基本資訊（地址、統編）
  - 組織建立後可邀請成員

#### GH-006: 邀請組織成員

- **ID**: GH-006
- **描述**: 作為組織管理員，我希望能夠邀請成員加入組織。
- **驗收標準**:
  - 可透過 Email 發送邀請
  - 可設定邀請者的角色
  - 邀請連結 7 天內有效
  - 被邀請者需確認加入
  - 可查看待處理的邀請清單
  - 可撤銷未接受的邀請

#### GH-007: 建立團隊

- **ID**: GH-007
- **描述**: 作為組織管理員，我希望能夠建立團隊，以便分組管理成員。
- **驗收標準**:
  - 可輸入團隊名稱、描述
  - 可指定團隊負責人
  - 可將組織成員加入團隊
  - 團隊可指派至特定藍圖
  - 成員可同時屬於多個團隊

#### GH-008: 切換工作環境

- **ID**: GH-008
- **描述**: 作為一個同時屬於多個組織的使用者，我希望能夠切換工作環境。
- **驗收標準**:
  - Header 顯示當前組織/團隊
  - 可快速切換組織
  - 切換後顯示該組織的藍圖與資料
  - 記住上次選擇的環境

### 10.3 藍圖管理

#### GH-009: 建立藍圖

- **ID**: GH-009
- **描述**: 作為專案經理，我希望能夠建立藍圖，以便管理新專案。
- **驗收標準**:
  - 可輸入藍圖名稱、描述
  - 可設定開始/結束日期
  - 可設定藍圖擁有者
  - 可設定藍圖狀態（規劃中/進行中/暫停/完成/封存）
  - 建立後自動導向藍圖詳情頁

#### GH-010: 藍圖設定

- **ID**: GH-010
- **描述**: 作為藍圖擁有者，我希望能夠設定藍圖參數。
- **驗收標準**:
  - 可設定工作日曆（週休/假日）
  - 可設定通知規則
  - 可新增自訂欄位
  - 可管理藍圖成員與權限
  - 可設定進度計算規則

#### GH-011: Fork 藍圖給協作組織

- **ID**: GH-011
- **描述**: 作為藍圖擁有者，我希望能夠 Fork 藍圖給協作組織，以便分包施工。
- **驗收標準**:
  - 可選擇要 Fork 的任務範圍
  - 可選擇協作組織
  - 協作組織收到邀請通知
  - 協作組織接受後建立分支
  - 分支權限限制為僅操作承攬欄位

#### GH-012: 提交 Pull Request

- **ID**: GH-012
- **描述**: 作為協作組織成員，我希望能夠提交 PR，以便回報執行進度。
- **驗收標準**:
  - 可選擇要提交的變更內容
  - 可輸入 PR 說明
  - PR 建立後通知藍圖擁有者
  - 可在 PR 中進行討論
  - 藍圖擁有者可審核/合併/拒絕

### 10.4 任務管理

#### GH-013: 建立任務

- **ID**: GH-013
- **描述**: 作為專案經理，我希望能夠建立任務，以便規劃施工項目。
- **驗收標準**:
  - 可輸入任務名稱、描述
  - 可設定父任務（建立階層關係）
  - 可設定優先級（低/中/高/緊急）
  - 可設定開始/截止日期
  - 可設定預估工時
  - 可指派負責人

#### GH-014: 檢視任務樹狀圖

- **ID**: GH-014
- **描述**: 作為使用者，我希望能夠以樹狀圖檢視任務，以便了解任務結構。
- **驗收標準**:
  - 以階層縮排顯示任務
  - 可展開/收合子任務
  - 顯示任務膠囊（層級/優先/進度/狀態/負責人/截止日）
  - 已完成任務顯示完工照片縮圖
  - 可拖拉調整任務順序
  - 支援任務搜尋與篩選

#### GH-015: 更新任務狀態

- **ID**: GH-015
- **描述**: 作為施工人員，我希望能夠更新任務狀態，以便回報進度。
- **驗收標準**:
  - 可變更任務狀態（待處理 → 進行中 → 暫存中 → ...）
  - 狀態變更需確認
  - 變更後即時更新 UI
  - 變更記錄在活動日誌
  - 相關人員收到通知

#### GH-016: 提交任務至暫存區

- **ID**: GH-016
- **描述**: 作為施工人員，我希望能夠將完成的任務提交至暫存區。
- **驗收標準**:
  - 完成任務後可提交至暫存區
  - 暫存區保留 48 小時
  - 48 小時內可撤回修改
  - 暫存區內容可預覽
  - 過期後自動確認

#### GH-017: 上傳任務完工照片

- **ID**: GH-017
- **描述**: 作為施工人員，我希望能夠上傳完工照片，以便記錄施工結果。
- **驗收標準**:
  - 可選擇多張照片上傳
  - 顯示上傳進度
  - 自動壓縮優化
  - 保留 EXIF 資訊（時間、地點）
  - 照片縮圖顯示在任務卡片
  - 點擊可放大檢視

### 10.5 每日日誌

#### GH-018: 填寫每日施工日誌

- **ID**: GH-018
- **描述**: 作為工地主任，我希望能夠填寫每日施工日誌。
- **驗收標準**:
  - 可選擇日期（預設當日）
  - 可輸入工作摘要
  - 可記錄工作時數
  - 可記錄工人數量
  - 可上傳施工照片
  - 自動帶入天氣資訊

#### GH-019: 管理日誌照片

- **ID**: GH-019
- **描述**: 作為工地主任，我希望能夠管理日誌照片。
- **驗收標準**:
  - 可批次上傳照片
  - 可為照片新增說明
  - 可分類標籤照片
  - 可刪除照片
  - 照片自動壓縮

#### GH-020: 檢視歷史日誌

- **ID**: GH-020
- **描述**: 作為使用者，我希望能夠檢視歷史日誌。
- **驗收標準**:
  - 可按日期範圍篩選
  - 可按人員篩選
  - 可按任務篩選
  - 日誌清單顯示摘要
  - 點擊可檢視詳情

### 10.6 品質驗收

#### GH-021: 管理檢查清單模板

- **ID**: GH-021
- **描述**: 作為品管人員，我希望能夠管理檢查清單模板。
- **驗收標準**:
  - 可建立清單模板
  - 可新增/編輯/刪除檢查項目
  - 可設定評分標準
  - 可分類檢查項目
  - 模板可複製

#### GH-022: 發起品質驗收

- **ID**: GH-022
- **描述**: 作為工地主任，我希望能夠發起品質驗收。
- **驗收標準**:
  - 可選擇要驗收的任務
  - 可選擇檢查清單模板
  - 可指派品管人員
  - 發起後通知品管人員
  - 任務狀態變為「品管中」

#### GH-023: 執行品質檢查

- **ID**: GH-023
- **描述**: 作為品管人員，我希望能夠執行品質檢查。
- **驗收標準**:
  - 可逐項確認檢查項目
  - 可為每項評分
  - 可新增備註
  - 可上傳缺陷照片
  - 可拍攝前/中/後對比照

#### GH-024: 完成驗收判定

- **ID**: GH-024
- **描述**: 作為品管人員，我希望能夠完成驗收判定。
- **驗收標準**:
  - 可判定為通過/不通過/有條件通過
  - 不通過需填寫原因
  - 不通過自動開立問題單
  - 相關人員收到通知
  - 任務狀態更新

#### GH-025: 串驗收流程

- **ID**: GH-025
- **描述**: 作為專案經理，我希望能夠設定串驗收流程。
- **驗收標準**:
  - 可定義多階段驗收
  - 可為每階段指定驗收人員
  - 前一階段通過才能進入下一階段
  - 可追蹤驗收鏈狀態
  - 所有階段通過才算完成

### 10.7 問題追蹤

#### GH-026: 手動開立問題

- **ID**: GH-026
- **描述**: 作為使用者，我希望能夠手動開立問題。
- **驗收標準**:
  - 可輸入問題標題、描述
  - 可選擇關聯任務
  - 可設定嚴重程度
  - 可上傳問題照片
  - 可指派處理人員

#### GH-027: 處理問題

- **ID**: GH-027
- **描述**: 作為被指派者，我希望能夠處理問題。
- **驗收標準**:
  - 可更新處理進度
  - 可新增處理記錄
  - 可上傳處理後照片
  - 處理完成後可申請關閉
  - 問題開立者確認後關閉

#### GH-028: 問題跨分支同步

- **ID**: GH-028
- **描述**: 作為藍圖擁有者，我希望能夠看到所有分支的問題。
- **驗收標準**:
  - 分支問題即時同步至主分支
  - 主分支可看到所有問題
  - 問題狀態即時更新
  - 可篩選顯示特定分支問題

### 10.8 協作溝通

#### GH-029: 任務討論

- **ID**: GH-029
- **描述**: 作為使用者，我希望能夠在任務中進行討論。
- **驗收標準**:
  - 可在任務詳情頁留言
  - 支援巢狀回覆
  - 支援 @提及
  - 被提及者收到通知
  - 即時更新留言

#### GH-030: 通知管理

- **ID**: GH-030
- **描述**: 作為使用者，我希望能夠管理通知。
- **驗收標準**:
  - 可檢視所有通知
  - 可標記已讀/未讀
  - 可批次刪除
  - 可設定通知偏好
  - 支援通知分類顯示

#### GH-031: 待辦中心

- **ID**: GH-031
- **描述**: 作為使用者，我希望能夠使用待辦中心管理工作。
- **驗收標準**:
  - 顯示我的待辦事項
  - 按五狀態分類顯示
  - 可依優先級排序
  - 顯示截止日期
  - 點擊可跳轉至對應功能

### 10.9 報表分析

#### GH-032: 檢視進度報表

- **ID**: GH-032
- **描述**: 作為專案經理，我希望能夠檢視進度報表。
- **驗收標準**:
  - 顯示整體完成率
  - 顯示計劃 vs 實際曲線
  - 顯示里程碑狀態
  - 可選擇時間範圍
  - 可匯出 PDF/Excel

#### GH-033: 檢視品質報表

- **ID**: GH-033
- **描述**: 作為品管人員，我希望能夠檢視品質報表。
- **驗收標準**:
  - 顯示驗收統計
  - 顯示缺陷率趨勢
  - 顯示問題分類統計
  - 可選擇時間範圍
  - 可匯出 PDF/Excel

#### GH-034: 檢視工時報表

- **ID**: GH-034
- **描述**: 作為專案經理，我希望能夠檢視工時報表。
- **驗收標準**:
  - 顯示人員工時統計
  - 顯示任務工時分析
  - 顯示工時趨勢圖
  - 可選擇時間範圍
  - 可匯出 PDF/Excel

### 10.10 離線與同步

#### GH-035: 離線瀏覽

- **ID**: GH-035
- **描述**: 作為工地使用者，我希望在離線時也能瀏覽資料。
- **驗收標準**:
  - 離線時可瀏覽已快取的資料
  - 顯示離線狀態指示
  - 離線時核心功能可用
  - 離線資料自動更新

#### GH-036: 離線操作

- **ID**: GH-036
- **描述**: 作為工地使用者，我希望在離線時也能執行操作。
- **驗收標準**:
  - 離線時可更新任務狀態
  - 離線時可填寫日誌
  - 離線時可上傳照片（暫存）
  - 操作暫存於本機
  - 恢復連線後自動同步

#### GH-037: 同步衝突解決

- **ID**: GH-037
- **描述**: 作為使用者，當發生同步衝突時，我希望能夠解決。
- **驗收標準**:
  - 偵測同步衝突
  - 顯示衝突提示
  - 提供衝突解決選項
  - 可選擇保留本機或伺服器版本
  - 解決後繼續同步

### 10.11 系統管理

#### GH-038: 系統設定管理

- **ID**: GH-038
- **描述**: 作為超級管理員，我希望能夠管理系統設定。
- **驗收標準**:
  - 可設定全域參數
  - 可管理功能開關
  - 可查看系統日誌
  - 可管理 API 金鑰
  - 可設定備份排程

#### GH-039: 功能開關管理

- **ID**: GH-039
- **描述**: 作為超級管理員，我希望能夠管理功能開關。
- **驗收標準**:
  - 可啟用/停用特定功能
  - 可設定目標使用者/組織
  - 可設定灰度發布比例
  - 開關即時生效
  - 可查看功能使用統計

#### GH-040: 活動日誌查詢

- **ID**: GH-040
- **描述**: 作為管理員，我希望能夠查詢活動日誌。
- **驗收標準**:
  - 可按時間範圍查詢
  - 可按使用者查詢
  - 可按操作類型查詢
  - 可按實體查詢
  - 可匯出日誌

---

## 附錄

### A. 資料模型參考

現有資料模型已設計完成，詳見：
- `docs/architecture/06-entity-relationship-diagram.mermaid.md`
- `database_export_20251124_133450.sql`

### B. 技術棧

| 類別 | 技術 | 版本 |
|------|------|------|
| 前端框架 | Angular | 20.3.x |
| UI 框架 | ng-alain | 20.1.x |
| UI 元件庫 | ng-zorro-antd | 20.3.x |
| 狀態管理 | Angular Signals | - |
| 後端服務 | Supabase | 2.84.x |
| 資料庫 | PostgreSQL | 15.x |
| 認證 | Supabase Auth + @delon/auth | - |

### C. 相關文件

- 系統架構圖：`docs/architecture/01-system-architecture-mindmap.mermaid.md`
- 帳戶層流程圖：`docs/architecture/05-account-layer-flowchart.mermaid.md`
- RLS 權限矩陣：`docs/architecture/09-security-rls-permission-matrix.md`
- 專案分析報告：`docs/PROJECT-ANALYSIS-REPORT.md`

### D. 變更記錄

| 版本 | 日期 | 變更內容 | 作者 |
|------|------|----------|------|
| 1.0.0 | 2025-11-26 | 初版建立 | GitHub Copilot |

---

**文件狀態**: 草稿  
**審核狀態**: 待審核  
**下一步**: 與利害關係人確認需求後，進入開發階段
