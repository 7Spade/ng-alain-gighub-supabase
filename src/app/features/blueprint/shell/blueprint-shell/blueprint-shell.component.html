<!--
  Blueprint Shell Template
  
  Main container for blueprint modules
  Provides navigation and context display
  Integrated with WorkspaceContextFacade for context switching
-->

<page-header [title]="'藍圖容器'">
  <ng-template #action>
    <button nz-button nzType="default" (click)="navigateToModule('task')">
      <i nz-icon nzType="project" nzTheme="outline"></i>
      任務模組
    </button>
    <!-- Future modules can be added here -->
  </ng-template>
</page-header>

<!-- Loading State -->
@if (loading() || switching()) {
  <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
}

<!-- Error State -->
@if (error()) {
  <nz-alert
    nzType="error"
    [nzMessage]="'載入失敗'"
    [nzDescription]="error()"
    nzShowIcon
  ></nz-alert>
}

<!-- Current Context Display -->
<nz-card [nzTitle]="'當前上下文'" class="mb-md">
  @if (hasValidContext()) {
    <nz-descriptions [nzColumn]="3" nzBordered>
      <nz-descriptions-item [nzTitle]="'上下文類型'">
        <nz-tag [nzColor]="contextTagColor()">
          <i nz-icon [nzType]="contextIcon()" nzTheme="outline" class="mr-xs"></i>
          {{ contextTypeLabel() }}
        </nz-tag>
      </nz-descriptions-item>
      <nz-descriptions-item [nzTitle]="'名稱'">
        {{ contextLabel() }}
      </nz-descriptions-item>
      <nz-descriptions-item [nzTitle]="'狀態'">
        <nz-badge nzStatus="success" nzText="已連接"></nz-badge>
      </nz-descriptions-item>
    </nz-descriptions>
    <nz-alert
      nzType="success"
      nzMessage="上下文切換器已整合"
      nzDescription="藍圖容器已與上下文切換器成功整合。當您切換帳戶、組織或團隊時，藍圖資料將自動更新。"
      nzShowIcon
      class="mt-md">
    </nz-alert>
  } @else {
    <nz-alert
      nzType="warning"
      nzMessage="請選擇上下文"
      nzDescription="請點擊左側的用戶頭像，在下拉選單中選擇一個帳戶、組織或團隊以啟用藍圖功能。"
      nzShowIcon>
    </nz-alert>
    <div class="text-center mt-md">
      <button nz-button nzType="primary" (click)="navigateToAccount()">
        <i nz-icon nzType="user" nzTheme="outline"></i>
        前往帳戶頁面
      </button>
    </div>
  }
</nz-card>

<!-- Blueprint Info -->
@if (selectedBlueprint()) {
  <nz-card [nzTitle]="'藍圖資訊'" class="mb-md">
    <nz-descriptions [nzColumn]="2" nzBordered>
      <nz-descriptions-item [nzTitle]="'名稱'">
        {{ selectedBlueprint()?.name }}
      </nz-descriptions-item>
      <nz-descriptions-item [nzTitle]="'類別'">
        {{ selectedBlueprint()?.category }}
      </nz-descriptions-item>
      <nz-descriptions-item [nzTitle]="'描述'" [nzSpan]="2">
        {{ selectedBlueprint()?.description }}
      </nz-descriptions-item>
      <nz-descriptions-item [nzTitle]="'可見性'">
        <nz-badge 
          [nzStatus]="selectedBlueprint()?.visibility === 'public' ? 'success' : 'default'" 
          [nzText]="selectedBlueprint()?.visibility">
        </nz-badge>
      </nz-descriptions-item>
      <nz-descriptions-item [nzTitle]="'狀態'">
        <nz-badge 
          [nzStatus]="selectedBlueprint()?.status === 'published' ? 'processing' : 'default'" 
          [nzText]="selectedBlueprint()?.status">
        </nz-badge>
      </nz-descriptions-item>
    </nz-descriptions>
  </nz-card>
}

<!-- Module Navigation -->
<nz-card [nzTitle]="'可用模組'">
  <nz-row [nzGutter]="16">
    <nz-col [nzSpan]="8">
      <nz-card 
        nzHoverable 
        [nzTitle]="'任務模組'"
        (click)="navigateToModule('task')"
        class="module-card">
        <i nz-icon nzType="project" nzTheme="outline" class="module-icon"></i>
        <p>管理無限層級的任務樹狀結構</p>
        <nz-tag [nzColor]="'blue'">已實作</nz-tag>
      </nz-card>
    </nz-col>
    <nz-col [nzSpan]="8">
      <nz-card 
        nzHoverable 
        [nzTitle]="'未來模組'"
        class="module-card disabled">
        <i nz-icon nzType="inbox" nzTheme="outline" class="module-icon"></i>
        <p>更多模組即將推出</p>
        <nz-tag [nzColor]="'default'">規劃中</nz-tag>
      </nz-card>
    </nz-col>
  </nz-row>
</nz-card>

<!-- Router Outlet for Child Routes -->
<div class="blueprint-content">
  <router-outlet></router-outlet>
</div>
